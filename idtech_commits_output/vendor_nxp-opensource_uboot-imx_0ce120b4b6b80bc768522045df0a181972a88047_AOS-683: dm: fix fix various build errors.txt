0ce120b4b6 George.Huang 2021-07-27

AOS-683: dm: fix fix various build errors

Reference from:

  commit b0db69b4e1e1bf1109bd9d4a5185cbd4058f4a8b
  Author: Dario Binacchi <dariobin@libero.it>
  Date:   Fri Jan 15 09:10:26 2021 +0100

    dm: fix build errors generated by last merges

    Something was wrong in the merge process into the mainline.
    Some added patches access driver structure fields and functions that
    have been modified by previous patches.
    The patch renames:
     - dev_get_platdata to dev_get_plat
     - dev_get_uclass_platdata to dev_get_uclass_plat
     - ofdata_to_platdata to of_to_plat
     - plat_data_alloc_size to plat_auto
     - priv_auto_alloc_size to priv_auto
     - video_uc_platdata to video_uc_plat

Change-Id: If29f6e900d6f012dc338f89e416e40d4accc8cf7

diff --git a/drivers/video/himax-hx8394f.c b/drivers/video/himax-hx8394f.c
index ed4a32f19d..46b7716a47 100644
--- a/drivers/video/himax-hx8394f.c
+++ b/drivers/video/himax-hx8394f.c
@@ -11,6 +11,7 @@
 #include <panel.h>
 #include <asm/gpio.h>
 #include <dm/device_compat.h>
+#include <linux/delay.h>
 
 struct hx8394f_panel_priv {
 	struct udevice *backlight;
@@ -35,7 +36,7 @@ static const struct display_timing default_timing = {
 static void hx8394f_dcs_write_buf(struct udevice *dev, const void *data,
 				  size_t len)
 {
-	struct mipi_dsi_panel_plat *plat = dev_get_platdata(dev);
+	struct mipi_dsi_panel_plat *plat = dev_get_plat(dev);
 	struct mipi_dsi_device *device = plat->device;
 	int err;
 
@@ -46,7 +47,7 @@ static void hx8394f_dcs_write_buf(struct udevice *dev, const void *data,
 
 static void hx8394f_dcs_write_cmd(struct udevice *dev, u8 cmd, u8 value)
 {
-	struct mipi_dsi_panel_plat *plat = dev_get_platdata(dev);
+	struct mipi_dsi_panel_plat *plat = dev_get_plat(dev);
 	struct mipi_dsi_device *device = plat->device;
 	int err;
 
@@ -146,7 +147,7 @@ reset_out:
 
 static int hx8394f_panel_enable_backlight(struct udevice *dev)
 {
-	struct mipi_dsi_panel_plat *plat = dev_get_platdata(dev);
+	struct mipi_dsi_panel_plat *plat = dev_get_plat(dev);
 	struct mipi_dsi_device *device = plat->device;
 	struct hx8394f_panel_priv *priv = dev_get_priv(dev);
 	int ret;
@@ -270,6 +271,6 @@ U_BOOT_DRIVER(hx8394f_panel) = {
 	.ops			  = &hx8394f_panel_ops,
 	.probe			  = hx8394f_panel_probe,
 	.remove			  = hx8394f_panel_disable,
-	.platdata_auto_alloc_size = sizeof(struct mipi_dsi_panel_plat),
-	.priv_auto_alloc_size	= sizeof(struct hx8394f_panel_priv),
+	.plat_auto		  = sizeof(struct mipi_dsi_panel_plat),
+	.priv_auto		  = sizeof(struct hx8394f_panel_priv),
 };
diff --git a/drivers/video/hx8238d.c b/drivers/video/hx8238d.c
index f7e7753a53..deb14bf43e 100644
--- a/drivers/video/hx8238d.c
+++ b/drivers/video/hx8238d.c
@@ -85,7 +85,7 @@ struct hx8238d_priv {
 	struct spi_slave *spi;
 };
 
-static int hx8238d_ofdata_to_platdata(struct udevice *dev)
+static int hx8238d_of_to_plat(struct udevice *dev)
 {
 	struct hx8238d_priv *priv = dev_get_priv(dev);
 
@@ -191,7 +191,7 @@ U_BOOT_DRIVER(hx8238d) = {
 	.name = "hx8238d",
 	.id = UCLASS_PANEL,
 	.of_match = hx8238d_ids,
-	.ofdata_to_platdata = hx8238d_ofdata_to_platdata,
+	.of_to_plat = hx8238d_of_to_plat,
 	.probe = hx8238d_probe,
-	.priv_auto_alloc_size = sizeof(struct hx8238d_priv),
+	.priv_auto = sizeof(struct hx8238d_priv),
 };
diff --git a/drivers/video/mxsfb.c b/drivers/video/mxsfb.c
index bb56cc75b0..45d2d8d511 100644
--- a/drivers/video/mxsfb.c
+++ b/drivers/video/mxsfb.c
@@ -273,7 +273,7 @@ static int mxs_probe_common(phys_addr_t reg_base, struct display_timing *timings
 {
 	/* Start framebuffer */
 #ifdef CONFIG_IMX8MQ
-	imx8mq_lcdif_init(reg_base, fb, mode, bpp, bridge, enable_pol);
+	imx8mq_lcdif_init(reg_base, fb, timings, bpp, bridge);
 #else /* !CONFIG_IMX8MQ */
 	mxs_lcd_init(reg_base, fb, timings, bpp, bridge);
 #endif /* CONFIG_IMX8MQ */
