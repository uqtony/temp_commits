095e202 jenkins 2020-12-18

Download imx-android-11.0.0_1.0.0.tar.gz from nxp.com

Change-Id: I59f48a7d4d7c3b746377a9620348f6e14135ab25

diff --git a/CactusPlayer/Android.mk b/CactusPlayer/Android.mk
index 19884ce..4f5b8fe 100755
--- a/CactusPlayer/Android.mk
+++ b/CactusPlayer/Android.mk
@@ -11,7 +11,7 @@ LOCAL_SRC_FILES := $(call all-java-files-under, src)
 
 LOCAL_PACKAGE_NAME := CactusPlayer
 
-LOCAL_PRIVATE_PLATFORM_APIS := current
+LOCAL_SDK_VERSION := system_current
 
 LOCAL_CERTIFICATE := platform
 
diff --git a/CactusPlayer/src/com/freescale/cactusplayer/HdmiApplication.java b/CactusPlayer/src/com/freescale/cactusplayer/HdmiApplication.java
index aeea418..3d7c04f 100755
--- a/CactusPlayer/src/com/freescale/cactusplayer/HdmiApplication.java
+++ b/CactusPlayer/src/com/freescale/cactusplayer/HdmiApplication.java
@@ -70,6 +70,7 @@ public class HdmiApplication extends Application{
     private int mVideoIndex = -1;
     private boolean mPresentation_loopstatus = false;
     private boolean mPresentationEnded = false;
+    private DisplayManager mDisplayManager = null;
 
     public final static String EXTRA_HDMI_PLUGGED_STATE = "state";
     public final static String ACTION_HDMI_PLUGGED = "android.intent.action.HDMI_PLUGGED";
@@ -120,10 +121,20 @@ public class HdmiApplication extends Application{
         // Get the current route and its presentation display.
         MediaRouter.RouteInfo route = mMediaRouter.getSelectedRoute(
                 MediaRouter.ROUTE_TYPE_LIVE_VIDEO);
-        Display presentationDisplay = route != null ? route.getPresentationDisplay() : null;
-        if (mPresentation == null && presentationDisplay != null) {
-            Log.w(TAG, "Showing presentation on display: " + presentationDisplay);
-            mPresentation = new DemoPresentation(this, presentationDisplay);
+        mDisplayManager = getSystemService(DisplayManager.class);
+        Display[] presentationDisplays = mDisplayManager.getDisplays(DisplayManager.DISPLAY_CATEGORY_PRESENTATION);
+        Log.d(TAG,"display count " + presentationDisplays.length);
+        Display display = null;
+        if (presentationDisplays.length > 1) {
+            display = presentationDisplays[1];
+        } else if(presentationDisplays.length == 1){
+            display = presentationDisplays[0];
+        }
+
+        if (mPresentation == null && display != null) {
+            final int displayId = display.getDisplayId();
+            Log.w(TAG, "Showing presentation on display: " + display);
+            mPresentation = new DemoPresentation(this, display);
             try {
                 WindowManager.LayoutParams l = mPresentation.getWindow().getAttributes();
                 //l.type = WindowManager.LayoutParams.FIRST_SYSTEM_WINDOW + 100;
@@ -340,7 +351,7 @@ public class HdmiApplication extends Application{
          protected void onStart() {
              super.onStart();
              getContentResolver().registerContentObserver(Settings.Global.getUriFor(
-                 Settings.Global.WIFI_ON), false, mSettingsObserver, UserHandle.USER_ALL);
+                 Settings.Global.WIFI_ON), false, mSettingsObserver);
              mHandler.sendEmptyMessageDelayed(SHOW_PROGRESSBAR, 500);
              mHandler.sendEmptyMessageDelayed(SHOW_PROGRESSTIME, 500);
              IntentFilter filter = new IntentFilter();
diff --git a/CactusPlayer/src/com/freescale/cactusplayer/VideoPlayer.java b/CactusPlayer/src/com/freescale/cactusplayer/VideoPlayer.java
index d799351..c86c00a 100755
--- a/CactusPlayer/src/com/freescale/cactusplayer/VideoPlayer.java
+++ b/CactusPlayer/src/com/freescale/cactusplayer/VideoPlayer.java
@@ -1577,18 +1577,7 @@ public class VideoPlayer extends Activity implements HdmiApplication.Callback,
                         if(ti[j].getTrackType() == MediaPlayer.TrackInfo.MEDIA_TRACK_TYPE_AUDIO)
                             index++;
                         if(index == i){
-                            //mMediaPlayer.selectTrack(j);
-                            Parcel request = Parcel.obtain();
-                            Parcel reply = Parcel.obtain();
-                            try {
-                                request.writeInterfaceToken(IMEDIA_PLAYER);
-                                request.writeInt(INVOKE_ID_SELECT_TRACK);
-                                request.writeInt(j);
-                                mMediaPlayer.invoke(request, reply);
-                            } finally {
-                                request.recycle();
-                                reply.recycle();
-                            }
+                            mMediaPlayer.selectTrack(j);
                             //mInfoView.setText();
                             mCurAudioTrack = j;
                             mCurAudioIndex = i;
diff --git a/codec2/process/common/ProcessBase.cpp b/codec2/process/common/ProcessBase.cpp
old mode 100755
new mode 100644
index 4ffc7b0..7c2914e
--- a/codec2/process/common/ProcessBase.cpp
+++ b/codec2/process/common/ProcessBase.cpp
@@ -91,6 +91,10 @@ ProcessBase::ProcessBase()
 }
 
 ProcessBase::~ProcessBase() {
+    if (mLooper != nullptr) {
+        mLooper->unregisterHandler(id());
+        mLooper->stop();
+    }
 }
 
 bool ProcessBase::getDefaultG2DLib(char *libName, int size) {
@@ -123,6 +127,7 @@ status_t ProcessBase::init(Client* client, const std::shared_ptr<C2BlockPool>& p
     mBlockPool = pool;
     mClient = client;
     (void)mLooper->registerHandler(this);
+
     nInputCnt = 0;
     nOutputCnt = 0;
 
@@ -131,7 +136,6 @@ status_t ProcessBase::init(Client* client, const std::shared_ptr<C2BlockPool>& p
     int32_t err;
     CHECK(reply->findInt32("err", &err));
 
-
     if (err == OK)
         mState = RUNNING;
 
@@ -210,9 +214,14 @@ status_t ProcessBase::queueInput(void* pVirt, void* pPhys, uint32_t size, uint64
 }
 
 status_t ProcessBase::flush() {
+
+    if(UNINITIALIZED == mState){
+        return OK;
+    }
+
+    int32_t err;
     sp<AMessage> reply;
     (new AMessage(kWhatFlush, this))->postAndAwaitResponse(&reply);
-    int32_t err;
     CHECK(reply->findInt32("err", &err));
     return err;
 }
diff --git a/codec2/store/ImxC2Store.cpp b/codec2/store/ImxC2Store.cpp
index b461b43..e404ec4 100755
--- a/codec2/store/ImxC2Store.cpp
+++ b/codec2/store/ImxC2Store.cpp
@@ -246,7 +246,7 @@ c2_status_t ImxC2Store::ComponentBox::init()
             }
 
             // set codec rank based on this prop, it is 0x111 as default
-            int flag = property_get_int32("media.fsl_codec.flag", 7);
+            int flag = property_get_int32("vendor.media.fsl_codec.flag", 7);
             bool useImxVideo = (flag & 0x2);
             bool useImxAudio = (flag & 0x4);
 
diff --git a/codec2/store/RegistryParser.cpp b/codec2/store/RegistryParser.cpp
index 64ac3d2..1bc2f63 100755
--- a/codec2/store/RegistryParser.cpp
+++ b/codec2/store/RegistryParser.cpp
@@ -146,19 +146,25 @@ REG_ERRORTYPE RegistryParser::DoParseRegList(char *file_name)
                     pRegEntry = &RegList[registerdCompNum];
                     if (!strncmp(pStrSeg, "component_name", strlen("component_name"))) {
                         pStrSeg = strtok_r(NULL, "=", &pLast);
-                        strcpy(pRegEntry->compName, pStrSeg);
-                        getCompName = true;
+                        if (pStrSeg && strlen(pStrSeg) < ITEM_NAME_LEN) {
+                            strcpy(pRegEntry->compName, pStrSeg);
+                            getCompName = true;
+                        }
                         ALOGV("registerdCompNum %d compName=%s", registerdCompNum, pRegEntry->compName);
                     } else if (!strncmp(pStrSeg, "library_path", strlen("library_path"))) {
                         pStrSeg = strtok_r(NULL, "=", &pLast);
-                        strcpy(pRegEntry->libName, pStrSeg);
-                        getLibName = true;
+                        if (pStrSeg && strlen(pStrSeg) < ITEM_NAME_LEN) {
+                            strcpy(pRegEntry->libName, pStrSeg);
+                            getLibName = true;
+                        }
                         ALOGV("registerdCompNum %d libName=%s", registerdCompNum, pRegEntry->libName);
                     } else if (!strncmp(pStrSeg, "include_file", strlen("include_file"))) {
                         pStrSeg = strtok_r(NULL, "=", &pLast);
-                        strcpy(includeFiles[includeFilesNum], pStrSeg);
-                        ALOGV("include_file=%s", pStrSeg);
-                        includeFilesNum++;
+                        if (pStrSeg && strlen(pStrSeg) < ITEM_NAME_LEN) {
+                            strcpy(includeFiles[includeFilesNum], pStrSeg);
+                            ALOGV("include_file=%s", pStrSeg);
+                            includeFilesNum++;
+                        }
                     }
 					memset(symbolBuffer, 0, ITEM_NAME_LEN);
 					symbolCnt = 0;
diff --git a/codec2/store/registry/c2_component_register_7ulp b/codec2/store/registry/c2_component_register_7ulp
index bc5b7da..54764a3 100644
--- a/codec2/store/registry/c2_component_register_7ulp
+++ b/codec2/store/registry/c2_component_register_7ulp
@@ -12,11 +12,6 @@ include_file=/vendor/etc/c2_component_register_ms;
 include_file=/vendor/etc/c2_component_register_ra;
 $
 
-@
-component_name=c2.imx.aac.decoder.sw;
-library_path=lib_c2_imx_aac_dec.so;
-$
-
 @
 component_name=c2.imx.mp3.decoder.sw;
 library_path=lib_c2_imx_mp3_dec.so;
diff --git a/codec2/store/registry/c2_component_register_8mm b/codec2/store/registry/c2_component_register_8mm
index d61cb84..c57736f 100644
--- a/codec2/store/registry/c2_component_register_8mm
+++ b/codec2/store/registry/c2_component_register_8mm
@@ -42,11 +42,6 @@ component_name=c2.imx.vp8.encoder;
 library_path=lib_imx_c2_videoenc.so;
 $
 
-@
-component_name=c2.imx.aac.decoder.sw;
-library_path=lib_c2_imx_aac_dec.so;
-$
-
 @
 component_name=c2.imx.mp3.decoder.sw;
 library_path=lib_c2_imx_mp3_dec.so;
diff --git a/codec2/store/registry/c2_component_register_8mn b/codec2/store/registry/c2_component_register_8mn
index bc5b7da..54764a3 100644
--- a/codec2/store/registry/c2_component_register_8mn
+++ b/codec2/store/registry/c2_component_register_8mn
@@ -12,11 +12,6 @@ include_file=/vendor/etc/c2_component_register_ms;
 include_file=/vendor/etc/c2_component_register_ra;
 $
 
-@
-component_name=c2.imx.aac.decoder.sw;
-library_path=lib_c2_imx_aac_dec.so;
-$
-
 @
 component_name=c2.imx.mp3.decoder.sw;
 library_path=lib_c2_imx_mp3_dec.so;
diff --git a/codec2/store/registry/c2_component_register_8mp b/codec2/store/registry/c2_component_register_8mp
index 4ce700e..1941931 100644
--- a/codec2/store/registry/c2_component_register_8mp
+++ b/codec2/store/registry/c2_component_register_8mp
@@ -45,11 +45,6 @@ component_name=c2.imx.hevc.encoder;
 library_path=lib_imx_c2_videoenc.so;
 $
 
-@
-component_name=c2.imx.aac.decoder.sw;
-library_path=lib_c2_imx_aac_dec.so;
-$
-
 @
 component_name=c2.imx.mp3.decoder.sw;
 library_path=lib_c2_imx_mp3_dec.so;
diff --git a/codec2/store/registry/c2_component_register_8mq b/codec2/store/registry/c2_component_register_8mq
index 898f694..7860185 100644
--- a/codec2/store/registry/c2_component_register_8mq
+++ b/codec2/store/registry/c2_component_register_8mq
@@ -59,11 +59,6 @@ component_name=c2.imx.xvid.decoder;
 library_path=lib_imx_c2_videodec.so;
 $
 
-@
-component_name=c2.imx.aac.decoder.sw;
-library_path=lib_c2_imx_aac_dec.so;
-$
-
 @
 component_name=c2.imx.mp3.decoder.sw;
 library_path=lib_c2_imx_mp3_dec.so;
diff --git a/codec2/store/registry/c2_component_register_8q b/codec2/store/registry/c2_component_register_8q
index 8dc23c2..34841ae 100644
--- a/codec2/store/registry/c2_component_register_8q
+++ b/codec2/store/registry/c2_component_register_8q
@@ -67,11 +67,6 @@ component_name=c2.imx.avc.encoder;
 library_path=lib_imx_c2_videoenc.so;
 $
 
-@
-component_name=c2.imx.aac.decoder.sw;
-library_path=lib_c2_imx_aac_dec.so;
-$
-
 @
 component_name=c2.imx.mp3.decoder.sw;
 library_path=lib_c2_imx_mp3_dec.so;
diff --git a/codec2/tsm/Tsm_wrapper.c b/codec2/tsm/Tsm_wrapper.c
index 7a5841b..b141865 100755
--- a/codec2/tsm/Tsm_wrapper.c
+++ b/codec2/tsm/Tsm_wrapper.c
@@ -329,9 +329,7 @@ TSM_TIMESTAMP tsmQueryCurrTs(void* pHandle)
 {
 	TSM_OBJ* pObj=(TSM_OBJ*)pHandle;
 	TSM_TIMESTAMP ts=TS_INVALIDTS;
-	TSM_TIMESTAMP tsOri=TS_INVALIDTS;
 	TSM_TIMESTAMP ts2=TS_INVALIDTS;
-	TSM_TIMESTAMP tsDiff;
 
 	if(pObj->pHandle2){
 #ifdef TS_USE_QUERY_API
@@ -372,15 +370,6 @@ TSM_TIMESTAMP tsmQueryCurrTs(void* pHandle)
 		//TS_DEBUG("new: query one ts: %lld 
",ts2);
 	}
 
-	//double check the ts for different schema
-	//if(pObj->pHandleOri && pObj->pHandle2){
-	if((tsOri!=TS_INVALIDTS)&&(ts2!=TS_INVALIDTS)){
-		tsDiff=TS_ABS(tsOri,ts2);
-		if(tsDiff>=TS_MAX_QUERY_DIFF_US){
-			TS_ERROR("LEVEL: 1 %s: the time stamp is conflict: ori ts(us): %lld, new ts(us): %lld, diff(us): %lld 
",__FUNCTION__,tsOri,ts2,tsDiff);
-		}
-	}
-
 	return ts;
 }
 
diff --git a/codec2/v4l2_dev/V4l2Dev.cpp b/codec2/v4l2_dev/V4l2Dev.cpp
index 2e86ecd..6391e41 100644
--- a/codec2/v4l2_dev/V4l2Dev.cpp
+++ b/codec2/v4l2_dev/V4l2Dev.cpp
@@ -526,12 +526,7 @@ status_t V4l2Dev::SetEncoderParam(V4l2EncInputParam *param)
     ALOGV("SetEncoderParam nBitRate=%d
",param->nBitRate);
     ALOGV("SetEncoderParam nGOPSize=%d
",param->nGOPSize);
     ALOGV("SetEncoderParam nIntraFreshNum=%d
",param->nIntraFreshNum);
-    if(param->nBitRate > 0){
-        ret |= SetCtrl(V4L2_CID_MPEG_VIDEO_BITRATE_MODE,param->nBitRateMode);
-        ret |= SetCtrl(V4L2_CID_MPEG_VIDEO_BITRATE,param->nBitRate);
-        ALOGV("V4L2_CID_MPEG_VIDEO_BITRATE 1 ret=%x
",ret);
-
-    }
+    ret = SetEncoderBitrate(param->nBitRateMode, param->nBitRate);
 
     if(param->nGOPSize > 0)
         ret |= SetCtrl(V4L2_CID_MPEG_VIDEO_GOP_SIZE,param->nGOPSize);
@@ -727,7 +722,8 @@ static const V4L2_ISO_MAP v4l2_ycbcr_table[]={
     { 9, V4L2_YCBCR_ENC_BT2020 },
     { 10, V4L2_YCBCR_ENC_BT2020_CONST_LUM },
 };
-status_t V4l2Dev::GetColorAspectsInfo(struct v4l2_pix_format_mplane * pixel_fmt, VideoColorAspect * desc){
+status_t V4l2Dev::GetColorAspectsInfo(struct v4l2_pix_format_mplane * pixel_fmt, VideoColorAspect * desc)
+{
 
     if(pixel_fmt == NULL || desc == NULL)
         return UNKNOWN_ERROR;
@@ -764,4 +760,48 @@ status_t V4l2Dev::GetColorAspectsInfo(struct v4l2_pix_format_mplane * pixel_fmt,
 
     return OK;
 }
+status_t V4l2Dev::SetColorAspectsInfo(VideoColorAspect * desc, struct v4l2_pix_format_mplane * pixel_fmt)
+{
+    if(pixel_fmt == NULL || desc == NULL)
+        return UNKNOWN_ERROR;
+
+    pixel_fmt->colorspace = V4L2_COLORSPACE_DEFAULT;
+    for( size_t i = 0; i < sizeof(v4l2_color_table)/sizeof(V4L2_ISO_MAP); i++){
+        if (desc->colourPrimaries == v4l2_color_table[i].iso_value) {
+            pixel_fmt->colorspace = v4l2_color_table[i].v4l2_value;
+            break;
+        }
+    }
+
+    pixel_fmt->xfer_func = V4L2_XFER_FUNC_DEFAULT;
+    for( size_t i = 0; i < sizeof(v4l2_xfer_table)/sizeof(V4L2_ISO_MAP); i++){
+        if (desc->transferCharacteristics == v4l2_xfer_table[i].iso_value) {
+            pixel_fmt->xfer_func = v4l2_xfer_table[i].v4l2_value;
+            break;
+        }
+    }
+
+    pixel_fmt->ycbcr_enc = V4L2_YCBCR_ENC_DEFAULT;
+    for( size_t i = 0; i < sizeof(v4l2_ycbcr_table)/sizeof(V4L2_ISO_MAP); i++){
+        if (desc->matrixCoeffs == v4l2_ycbcr_table[i].iso_value) {
+            pixel_fmt->ycbcr_enc = v4l2_ycbcr_table[i].v4l2_value;
+            break;
+        }
+    }
+
+    pixel_fmt->quantization = (desc->fullRange)? V4L2_QUANTIZATION_FULL_RANGE:V4L2_QUANTIZATION_LIM_RANGE;
+    ALOGV("SetColorAspectsInfo success, p=%d,t=%d,m=%d,r=%d
",
+        pixel_fmt->colorspace,pixel_fmt->xfer_func,pixel_fmt->ycbcr_enc,pixel_fmt->quantization);
+    return OK;
+}
+status_t V4l2Dev::SetEncoderBitrate(int32_t mode, int32_t bitrate){
+    int ret = 0;
+
+    if(bitrate > 0){
+        ret |= SetCtrl(V4L2_CID_MPEG_VIDEO_BITRATE_MODE,mode);
+        ret |= SetCtrl(V4L2_CID_MPEG_VIDEO_BITRATE,bitrate);
+    }
+    ALOGV("SetEncoderBitrate mode=%d,bitrate=%d ret=%x
",mode, bitrate, ret);
+    return ret;
+}
 }
diff --git a/codec2/v4l2_dev/V4l2Dev.h b/codec2/v4l2_dev/V4l2Dev.h
index 4b3f4be..84b03da 100644
--- a/codec2/v4l2_dev/V4l2Dev.h
+++ b/codec2/v4l2_dev/V4l2Dev.h
@@ -87,7 +87,8 @@ public:
     status_t SetH264EncoderProfileAndLevel(uint32_t profile, uint32_t level);
     status_t SetFrameRate(uint32_t framerate);
     status_t SetForceKeyFrame();
-    
+    status_t SetColorAspectsInfo(VideoColorAspect * desc, struct v4l2_pix_format_mplane * pixel_fmt);
+    status_t SetEncoderBitrate(int32_t mode, int32_t bitrate);
 private:
     status_t SearchName(V4l2DEV_TYPE type);
     bool isV4lBufferTypeSupported(int32_t fd, V4l2DEV_TYPE dec_type, uint32_t v4l2_buf_type);
diff --git a/codec2/video_dec/common/IMXC2VideoDecoder.cpp b/codec2/video_dec/common/IMXC2VideoDecoder.cpp
index 9321cb0..7334d48 100644
--- a/codec2/video_dec/common/IMXC2VideoDecoder.cpp
+++ b/codec2/video_dec/common/IMXC2VideoDecoder.cpp
@@ -625,7 +625,7 @@ c2_status_t IMXC2VideoDecoder::onFlush_sm() {
     err = mDecoder->flush();
     CHECK_AND_RETURN_C2_ERR(err);
 
-    if (bPPEnabled) {
+    if (bPPEnabled && mPostProcess) {
         err = mPostProcess->flush();
         CHECK_AND_RETURN_C2_ERR(err);
     }
@@ -639,7 +639,7 @@ c2_status_t IMXC2VideoDecoder::onFlush_sm() {
 
     nCurFrameIndex = 0;
     nUsedFrameIndex = 0;
-
+    ALOGV("onFlush_sm end");
     return C2ERR(err);
 }
 
@@ -827,6 +827,7 @@ void IMXC2VideoDecoder::releaseDecoder() {
 }
 
 void IMXC2VideoDecoder::handleOutputPicture(GraphicBlockInfo* info, uint64_t timestamp, uint32_t flag) {
+
     C2ConstGraphicBlock constBlock = info->mGraphicBlock->share(C2Rect(mCropWidth, mCropHeight), C2Fence());
     std::shared_ptr<C2Buffer> buffer = C2Buffer::CreateGraphicBuffer(std::move(constBlock));
     if(bPPEnabled){
@@ -1048,7 +1049,6 @@ void IMXC2VideoDecoder::notifyVideoInfo(VideoFormat *pFormat) {
         uint32_t transfer = colorAspects.transferCharacteristics;
         uint32_t matrix = colorAspects.matrixCoeffs;
         bool range = colorAspects.fullRange;
-
         memset(&aspects, 0, sizeof(aspects));
         ColorUtils::convertIsoColorAspectsToCodecAspects(primaries, transfer, matrix, range, aspects);
         if (!C2Mapper::map(aspects.mPrimaries, &codedAspects.primaries)) {
@@ -1063,7 +1063,7 @@ void IMXC2VideoDecoder::notifyVideoInfo(VideoFormat *pFormat) {
         if (!C2Mapper::map(aspects.mRange, &codedAspects.range)) {
             codedAspects.range = C2Color::RANGE_UNSPECIFIED;
         }
-        ALOGD("C2 color aspect p %d t %d m %d r %d",
+        ALOGD("C2 color aspect p %d r %d m %d t %d",
             codedAspects.primaries, codedAspects.range,
             codedAspects.matrix, codedAspects.transfer);
         std::vector<std::unique_ptr<C2SettingResult>> failures;
@@ -1190,6 +1190,10 @@ status_t IMXC2VideoDecoder::notifyProcessDone(int outputId, uint64_t timestamp,
         ALOGE("notifyProcessDone get invalid outputId: %d", outputId);
         return BAD_VALUE;
     }
+    if(pInfo->mGraphicBlock == NULL){
+        ALOGE("=== notifyProcessDone could not get mGraphicBlock outputId: %d", outputId);
+        return BAD_VALUE;
+    }
 
     GraphicBlockInfo graphicInfo;
 
diff --git a/codec2/video_dec/common/VideoDecoderBase.cpp b/codec2/video_dec/common/VideoDecoderBase.cpp
old mode 100755
new mode 100644
index c231ce5..d2c9a0a
--- a/codec2/video_dec/common/VideoDecoderBase.cpp
+++ b/codec2/video_dec/common/VideoDecoderBase.cpp
@@ -103,6 +103,8 @@ VideoDecoderBase::VideoDecoderBase()
       bAdaptiveMode(false),
       bSecureMode(false),
       bReceiveError(false),
+      bCodecDataReceived(false),
+      bCodecDataQueued(false),
       mLooper(new ALooper) {
 
     bOutputFmtChangedPending = false;
@@ -177,6 +179,12 @@ status_t VideoDecoderBase::queueInput(
     bool codecdata = ((flags & C2FrameData::FLAG_CODEC_CONFIG) != 0);
 
     if (codecdata) {
+        // previous csd is kept because it is not sent to decoder yet.
+        // if there is csd after flushing, clear previous csd
+        if (!bCodecDataReceived && !bCodecDataQueued && nCodecDataLen > 0) {
+            ALOGV("clear previous csd: nCodecDataLen %d", nCodecDataLen);
+            nCodecDataLen = 0;
+        }
         if (!pCodecDataBuf) {
             pCodecDataBuf = (uint8_t*)malloc(size);
         } else {
@@ -190,6 +198,7 @@ status_t VideoDecoderBase::queueInput(
 
         memcpy(pCodecDataBuf + nCodecDataLen, pInBuf, size);
         nCodecDataLen += size;
+        bCodecDataReceived = true;
         return OK;
     }
 
@@ -445,14 +454,13 @@ void VideoDecoderBase::onMessageReceived(const sp<AMessage> &msg) {
             break;
         }
         case kWhatFlush: {
+            ALOGV("kWhatFlush");
             Mutexed<InputBufferQueue>::Locked queue(mInputQueue);
             while (!queue->empty()) {
                 queue->pop_front();
             }
 
-            // flush codec data
-            //memset(pCodecDataBuf, 0, sizeof(nCodecDataLen));
-            nCodecDataLen = 0;
+            bCodecDataReceived = false;
             bReleasingDecoder = false;
 
             int32_t err = onFlush();
diff --git a/codec2/video_dec/common/VideoDecoderBase.h b/codec2/video_dec/common/VideoDecoderBase.h
old mode 100755
new mode 100644
index a099fbb..7434368
--- a/codec2/video_dec/common/VideoDecoderBase.h
+++ b/codec2/video_dec/common/VideoDecoderBase.h
@@ -189,6 +189,9 @@ protected:
     bool bSecureMode;
     bool bReceiveError;
 
+    bool bCodecDataReceived;
+    bool bCodecDataQueued;
+
     VideoFormat mInputFormat;
     VideoFormat mOutputFormat;
 
diff --git a/codec2/video_dec/v4l2_dec/V4l2Dec.cpp b/codec2/video_dec/v4l2_dec/V4l2Dec.cpp
index 3978c8f..a068fd0 100644
--- a/codec2/video_dec/v4l2_dec/V4l2Dec.cpp
+++ b/codec2/video_dec/v4l2_dec/V4l2Dec.cpp
@@ -52,6 +52,7 @@ V4l2Dec::V4l2Dec(const char* mime):
     bCodecDataQueued = false;
 
     bNeedPostProcess = true;
+    bMpeg2 = false;
 
     mState = UNINITIALIZED;
 
@@ -76,7 +77,8 @@ V4l2Dec::V4l2Dec(const char* mime):
     mOutputFormat.interlaced = false;
 
     mVc1Format = V4L2_PIX_FMT_VC1_ANNEX_G;
-
+    mLastInputTs = -1;
+    mLastInputId = 0;
 }
 V4l2Dec::~V4l2Dec()
 {
@@ -101,7 +103,8 @@ status_t V4l2Dec::onInit(){
     mState = UNINITIALIZED;
     mInCnt = 0;
     mOutCnt = 0;
-
+    mLastInputTs = -1;
+    mLastInputId = 0;
     ParseVpuLogLevel();
     return OK;
 }
@@ -165,6 +168,8 @@ status_t V4l2Dec::onStart()
 
     mInCnt = 0;
     mOutCnt = 0;
+    mLastInputTs = -1;
+    mLastInputId = 0;
     ALOGV("onStart ret=%d",ret);
     return ret;
 }
@@ -189,6 +194,10 @@ status_t V4l2Dec::prepareInputParams()
         return ret;
     }
 
+    if (strcmp(mMime, MEDIA_MIMETYPE_VIDEO_MPEG2) == 0) {
+        bMpeg2 = true;
+    }
+
     if(mInputFormat.bufferNum == 0){
         mInputFormat.bufferNum = 3;
     }
@@ -745,6 +754,7 @@ status_t V4l2Dec::decodeInternal(std::unique_ptr<IMXInputBuffer> input)
     int result = 0;
     int32_t index = -1;
     uint32_t v4l2_flags = 0;
+    bool returnEmptyWork = false;
 
     if(input == nullptr)
         return BAD_VALUE;
@@ -754,9 +764,9 @@ status_t V4l2Dec::decodeInternal(std::unique_ptr<IMXInputBuffer> input)
 
     if (!bCodecDataQueued && pCodecDataBuf && nCodecDataLen > 0) {
         bCodecDataQueued = true;
+        ALOGV("queue codecdata");
         status_t ret = decodeInternal(std::make_unique<IMXInputBuffer>(
                                         pCodecDataBuf, -1, -1, nCodecDataLen, -1, false, true));
-        nCodecDataLen = 0;
         if (ret != OK) {
             ALOGE("queue codecdata failed with ret %d", ret);
             return ret;
@@ -860,6 +870,15 @@ QueueOneBuffer:
     ALOGV("VIDIOC_QBUF OUTPUT_MPLANE END index=%d,len=%d, ts=%lld
",
         stV4lBuf.index, plane.bytesused, (long long)ts);
 
+    if(bMpeg2 && !input->csd){
+        if(mLastInputTs == ts){
+            returnEmptyWork = true;
+        }else{
+            mLastInputTs = ts;
+            mLastInputId = input->id;
+        }
+    }
+
     mInCnt++;
     mLock.unlock();
 
@@ -870,6 +889,12 @@ QueueOneBuffer:
         ALOGV("NotifyInputBufferUsed id=%d",input->id);
         NotifyInputBufferUsed(input->id);
     }
+
+    //if one frame was split into several input buffer, then skip previous input id
+    if(returnEmptyWork && mLastInputId > 0){
+        ALOGV("NotifySkipInputBuffer id=%d",mLastInputId);
+        NotifySkipInputBuffer(mLastInputId);
+    }
     return OK;
 }
 status_t V4l2Dec::dequeueInputBuffer()
@@ -1439,6 +1464,12 @@ status_t V4l2Dec::handleFormatChanged() {
         if(result < 0)
             return UNKNOWN_ERROR;
 
+        //seems decoder just be flushed
+        if(crop.c.width == 0 && crop.c.height == 0){
+            ALOGE("handleFormatChanged flushed return");
+            return OK;
+        }
+
         mOutputFormat.rect.right = crop.c.width;
         mOutputFormat.rect.bottom = crop.c.height;
         mOutputFormat.rect.top = crop.c.top;
@@ -1539,6 +1570,8 @@ status_t V4l2Dec::onFlush()
     mState = pre_state;
     mInCnt = 0;
     mOutCnt = 0;
+    mLastInputTs = -1;
+    mLastInputId = 0;
     bReceiveError = false;
     ALOGV("%s end", __FUNCTION__);
     return ret;
diff --git a/codec2/video_dec/v4l2_dec/V4l2Dec.h b/codec2/video_dec/v4l2_dec/V4l2Dec.h
index 28249e2..2beb9ec 100644
--- a/codec2/video_dec/v4l2_dec/V4l2Dec.h
+++ b/codec2/video_dec/v4l2_dec/V4l2Dec.h
@@ -117,9 +117,8 @@ private:
     bool bInputStreamOn;
     bool bOutputStreamOn;
 
-    bool bCodecDataQueued;
-
     bool bNeedPostProcess;
+    bool bMpeg2;
 
     int mState;
 
@@ -133,6 +132,8 @@ private:
     uint32_t mInCnt;
     uint32_t mOutCnt;
     uint32_t nDebugFlag;
+    uint64_t mLastInputTs;
+    int mLastInputId;
 
     VideoColorAspect mIsoColorAspect;
 
diff --git a/codec2/video_dec/vpuwrapper_dec/VpuWrapperDec.cpp b/codec2/video_dec/vpuwrapper_dec/VpuWrapperDec.cpp
old mode 100755
new mode 100644
index 995242b..a11cf12
--- a/codec2/video_dec/vpuwrapper_dec/VpuWrapperDec.cpp
+++ b/codec2/video_dec/vpuwrapper_dec/VpuWrapperDec.cpp
@@ -721,7 +721,7 @@ status_t VpuWrapperDec::onStart() {
 
     // workaround for MA-17234: CTS read framebuffer too often lead to buffer pool time out.
     // need to allocate framebuffer as cacheable for these videos.
-    if ((eCodingFormat == VPU_V_AVC || eCodingFormat == VPU_V_VP8) &&
+    if ((eCodingFormat == VPU_V_AVC || eCodingFormat == VPU_V_VP8 || eCodingFormat == VPU_V_HEVC) &&
         (mInputFormat.width == 1920 && mInputFormat.height == 1080)) {
         nOutBufferUsage = (uint64_t)(C2MemoryUsage::CPU_READ | C2MemoryUsage::CPU_WRITE | GRALLOC_USAGE_PRIVATE_2);
     }
@@ -920,8 +920,10 @@ decode_one_frame:
 	InData.pPhyAddr = NULL;
 	InData.pVirAddr = pBitstream;
 
-	InData.sCodecData.pData = pCodecDataBuf;
-	InData.sCodecData.nSize = nCodecDataLen;
+    if (pCodecDataBuf && nCodecDataLen > 0) {
+	    InData.sCodecData.pData = pCodecDataBuf;
+	    InData.sCodecData.nSize = nCodecDataLen;
+    }
 
     // MA-17685: don't send codecdata again for vc1, otherwise it will cause mosaic after seek
     if (pCodecDataBuf && nCodecDataLen > 0 && !(eCodingFormat == VPU_V_VC1 || eCodingFormat == VPU_V_VC1_AP)) {
@@ -971,8 +973,10 @@ decode_one_frame:
         goto decode_one_frame;
     }
 
-    if (pCodecDataBuf && nCodecDataLen > 0)
+    if (pCodecDataBuf && nCodecDataLen > 0) {
         nCodecDataLen = 0; // codecdata is handled, reset data length here.
+        bCodecDataQueued = true;
+    }
 
     if (err) {
         NotifyError(err);
diff --git a/codec2/video_enc/common/IMXC2VideoEncoder.cpp b/codec2/video_enc/common/IMXC2VideoEncoder.cpp
index 38385bc..899e0d3 100644
--- a/codec2/video_enc/common/IMXC2VideoEncoder.cpp
+++ b/codec2/video_enc/common/IMXC2VideoEncoder.cpp
@@ -187,7 +187,7 @@ public:
             addParameter(
                 DefineParam(mProfileLevel, C2_PARAMKEY_PROFILE_LEVEL)
                 .withDefault(new C2StreamProfileLevelInfo::output(
-                        0u, PROFILE_AVC_CONSTRAINED_BASELINE, LEVEL_AVC_4_1))
+                        0u, PROFILE_AVC_MAIN, LEVEL_AVC_4_1))
                 .withFields({
                     C2F(mProfileLevel, profile).oneOf({
                         PROFILE_AVC_BASELINE,
@@ -851,6 +851,11 @@ status_t IMXC2VideoEncoder::initComponent() {
         ALOGE("CreateVideoEncoderInstance for mime(%s) failed 
", mime);
         return C2_CORRUPTED;
     }
+    err = mEncoder->RegisterLooper();
+    if (err) {
+        ALOGE("mEncoder register handle fail");
+    }
+
 
     if (!bGetBlockPool) {
         if (OK != mEncoder->setLinearBlockPool(mOutputBlockPool))
diff --git a/codec2/video_enc/common/VideoEncoderBase.cpp b/codec2/video_enc/common/VideoEncoderBase.cpp
index f83dcc7..c975022 100755
--- a/codec2/video_enc/common/VideoEncoderBase.cpp
+++ b/codec2/video_enc/common/VideoEncoderBase.cpp
@@ -120,11 +120,15 @@ VideoEncoderBase::VideoEncoderBase()
 VideoEncoderBase::~VideoEncoderBase() {
 }
 
+status_t VideoEncoderBase::RegisterLooper() {
+    (void)mLooper->registerHandler(this);
+    return OK;
+}
+
 status_t VideoEncoderBase::init(Client* client/*const std::shared_ptr<C2BlockPool> &pool*/) {
 
     VEB_API_TRACE("%s, line %d", __FUNCTION__, __LINE__);
 
-    (void)mLooper->registerHandler(this);
     mClient = client;
     sp<AMessage> reply;
     (new AMessage(kWhatInit, this))->postAndAwaitResponse(&reply);
diff --git a/codec2/video_enc/common/VideoEncoderBase.h b/codec2/video_enc/common/VideoEncoderBase.h
index 39a5929..2dba8c1 100755
--- a/codec2/video_enc/common/VideoEncoderBase.h
+++ b/codec2/video_enc/common/VideoEncoderBase.h
@@ -171,6 +171,7 @@ public:
     virtual ~VideoEncoderBase();
 
     status_t init(Client* client/*const std::shared_ptr<C2BlockPool> &pool*/);//load componnent and init parameters
+    status_t RegisterLooper();
     status_t stop();//idle to loaded
     status_t flush();//flush
     status_t destroy();//free Buffers
@@ -227,7 +228,13 @@ protected:
     void NotifyResetDone();
     void NotifyEOS();
     void NotifyError(status_t err);
-
+    enum {
+        kInputBufferCount = 8,
+        kInputBufferSizeFor1080p = 1024 * 1024,
+        // Input bitstream buffer size for up to 4k streams.
+        kInputBufferSizeFor4k = 4 * kInputBufferSizeFor1080p,
+        kDefaultOutputBufferCount = 8,
+    };
 private:
     enum {
         kWhatEncode,
@@ -237,13 +244,7 @@ private:
         kWhatReset,
         kWhatDestroy,
     };
-    enum {
-        kInputBufferCount = 8,
-        kInputBufferSizeFor1080p = 1024 * 1024,
-        // Input bitstream buffer size for up to 4k streams.
-        kInputBufferSizeFor4k = 4 * kInputBufferSizeFor1080p,
-        kDefaultOutputBufferCount = 8,
-    };
+
 
     sp<ALooper> mLooper;
     Client* mClient;
diff --git a/codec2/video_enc/v4l2_enc/V4l2Enc.cpp b/codec2/video_enc/v4l2_enc/V4l2Enc.cpp
index 3b1b62b..7d1fdc7 100644
--- a/codec2/video_enc/v4l2_enc/V4l2Enc.cpp
+++ b/codec2/video_enc/v4l2_enc/V4l2Enc.cpp
@@ -26,6 +26,8 @@ namespace android {
 #define Align(ptr,align)    (((uint32_t)(ptr)+(align)-1)/(align)*(align))
 #define FRAME_ALIGN     (2)
 
+#define DEFAULT_INPUT_BUFFER_COUNT (16)
+
 V4l2Enc::V4l2Enc(const char* mime):
     mMime(mime),
     mPollThread(0),
@@ -33,7 +35,7 @@ V4l2Enc::V4l2Enc(const char* mime):
     pDev(NULL),
     mFd(-1){
 
-    mInputFormat.bufferNum = 8;
+    mInputFormat.bufferNum = DEFAULT_INPUT_BUFFER_COUNT;
     mInputFormat.bufferSize = DEFAULT_FRM_WIDTH * DEFAULT_FRM_HEIGHT * 3/2;
     mInputFormat.width = DEFAULT_FRM_WIDTH;
     mInputFormat.height = DEFAULT_FRM_HEIGHT;
@@ -43,7 +45,7 @@ V4l2Enc::V4l2Enc(const char* mime):
     mOutputFormat.width = DEFAULT_FRM_WIDTH;
     mOutputFormat.height = DEFAULT_FRM_HEIGHT;
     mOutputFormat.minBufferNum = 2;
-    mOutputFormat.bufferNum = 4;
+    mOutputFormat.bufferNum = kDefaultOutputBufferCount;
     mOutputFormat.interlaced = false;
 
     mConverter = NULL;
@@ -313,6 +315,8 @@ status_t V4l2Enc::SetInputFormats()
     format.fmt.pix_mp.plane_fmt[1].bytesperline = Align(mInputFormat.width, mWidthAlign);
     format.fmt.pix_mp.field = V4L2_FIELD_NONE;
 
+    pDev->SetColorAspectsInfo(&mIsoColorAspect, &format.fmt.pix_mp);
+
     result = ioctl (mFd, VIDIOC_S_FMT, &format);
     if(result != 0){
         ALOGE("SetInputFormats VIDIOC_S_FMT failed");
@@ -1084,7 +1088,13 @@ status_t V4l2Enc::DoSetConfig(EncConfig index, void* pConfig) {
     switch (index) {
         case ENC_CONFIG_BIT_RATE:
         {
-            mEncParam.nBitRate = (*(int*)pConfig);
+            int32_t tar = (*(int*)pConfig);
+            if(mEncParam.nBitRate > 0 && mEncParam.nBitRate != tar){
+                Mutex::Autolock autoLock(mLock);
+                ret = pDev->SetEncoderBitrate(V4L2_MPEG_VIDEO_BITRATE_MODE_CBR, tar);
+            }
+            ALOGV("SetConfig ENC_CONFIG_BIT_RATE src=%d,tar=%d",mEncParam.nBitRate,tar);
+            mEncParam.nBitRate = tar;
             break;
         }
         case ENC_CONFIG_INTRA_REFRESH:
@@ -1290,7 +1300,7 @@ void V4l2Enc::initEncInputParamter(EncInputParam *pInPara) {
     mWidth = pInPara->nPicWidth;
     mHeight = pInPara->nPicHeight;
 
-    mInputFormat.bufferNum = 8;
+    mInputFormat.bufferNum = DEFAULT_INPUT_BUFFER_COUNT;
     mInputFormat.bufferSize = mWidth * mHeight * 3/2;
     mInputFormat.width = mWidth;
     mInputFormat.height = mHeight;
@@ -1300,9 +1310,14 @@ void V4l2Enc::initEncInputParamter(EncInputParam *pInPara) {
     mOutputFormat.width = mWidth;
     mOutputFormat.height = mHeight;
     mOutputFormat.minBufferNum = 2;
-    mOutputFormat.bufferNum = 8;
+    mOutputFormat.bufferNum = kDefaultOutputBufferCount;
     mOutputFormat.interlaced = false;
-    
+
+    mIsoColorAspect.colourPrimaries = pInPara->sColorAspects.primaries;
+    mIsoColorAspect.transferCharacteristics = pInPara->sColorAspects.transfer;
+    mIsoColorAspect.matrixCoeffs = pInPara->sColorAspects.matrixCoeffs;
+    mIsoColorAspect.fullRange = pInPara->sColorAspects.fullRange;
+
     ALOGD("initEncInputParamter nRotAngle=%d,nBitRate=%d,nGOPSize=%d,nRefreshIntra=%d,mTargetFps=%d",
         pInPara->nRotAngle, pInPara->nBitRate, pInPara->nGOPSize, pInPara->nRefreshIntra,mTargetFps);
     
diff --git a/codec2/video_enc/v4l2_enc/V4l2Enc.h b/codec2/video_enc/v4l2_enc/V4l2Enc.h
old mode 100755
new mode 100644
index d92e275..9154149
--- a/codec2/video_enc/v4l2_enc/V4l2Enc.h
+++ b/codec2/video_enc/v4l2_enc/V4l2Enc.h
@@ -129,6 +129,8 @@ private:
     uint32_t nDebugFlag;
     int mState;
 
+    VideoColorAspect mIsoColorAspect;
+
     status_t prepareInputParams();
     status_t SetInputFormats();
     status_t prepareOutputParams();
diff --git a/extractor/Android.bp b/extractor/Android.bp
index 21896d8..b3a352a 100755
--- a/extractor/Android.bp
+++ b/extractor/Android.bp
@@ -54,6 +54,10 @@ cc_library_shared {
 		"libstagefright_foundation",
     ],
 
+    whole_static_libs: [
+        "libstagefright_metadatautils",
+    ],
+
     cflags: [
         "-Werror",
         "-Wall",
diff --git a/extractor/ImxExtractor.cpp b/extractor/ImxExtractor.cpp
old mode 100644
new mode 100755
index 5e2a07a..91f5f34
--- a/extractor/ImxExtractor.cpp
+++ b/extractor/ImxExtractor.cpp
@@ -16,6 +16,7 @@
 
 #include <media/stagefright/DataSourceBase.h>
 #include <media/MediaTrack.h>
+#include <media/stagefright/foundation/ABitReader.h>
 #include <media/stagefright/foundation/ADebug.h>
 #include <media/stagefright/foundation/AUtils.h>
 #include <media/stagefright/foundation/ABuffer.h>
@@ -46,7 +47,7 @@
 
 namespace android {
 #define MAX_USER_DATA_STRING_LENGTH 1024
-#define MAX_FRAME_BUFFER_LENGTH 10000000
+#define MAX_FRAME_BUFFER_LENGTH 20000000
 #define MAX_FRAME_BUFFER_LENGTH_4K 50000000
 #define MAX_VIDEO_BUFFER_SIZE (512*1024)
 #define MIN_VIDEO_BUFFER_SIZE (52*1024)
@@ -970,6 +971,7 @@ codec_mime_struct audio_mime_table[]={
     {AUDIO_ALAC,0,MEDIA_MIMETYPE_AUDIO_ALAC},
 };
 
+#ifdef USE_IMX_AAC_Dec
 static const uint64_t gM4aFilteredFileSizes[] = {
     // testDecodeM4a
     /*sinesweepm4a.m4a*/ 60053,
@@ -1063,6 +1065,7 @@ static bool FilterM4aFile(uint64_t fileSize) {
     return beFiltered;
 
 }
+#endif
 
 ImxExtractor::ImxExtractor(DataSourceHelper *source,const char *mime)
     : mDataSource(source),
@@ -1089,6 +1092,9 @@ ImxExtractor::ImxExtractor(DataSourceHelper *source,const char *mime)
     bSeekable = false;
     mMovieDuration = 0;
 
+    mAdtsBuffer = NULL;
+    mResyncAdts = true;
+
     memset(&fileOps, 0, sizeof(FslFileStream));
     memset(&memOps, 0, sizeof(ParserMemoryOps));
     memset(&outputBufferOps, 0, sizeof(ParserOutputBufferOps));
@@ -1606,6 +1612,8 @@ status_t ImxExtractor::ParseFromParser()
     bool bLive = mReader->isLiveStreaming();
     ALOGI("Core parser %s 
", IParser->getVersionInfo());
 
+    flag |= FLAG_FETCH_AAC_ADTS_CSD; // only for android, as google aac decoder MUST get esds
+
     if(IParser->createParser2){
         if(mReader->isStreaming())
             flag |= FILE_FLAG_READ_IN_SEQUENCE;
@@ -2168,6 +2176,7 @@ status_t ImxExtractor::ParseVideo(uint32 index, uint32 type,uint32 subtype)
     trackInfo->bitPerSample = 0;
     trackInfo->bMp4Encrypted = false;
     trackInfo->bMkvEncrypted = false;
+    trackInfo->bAacAdts = false;
     void * cryptoKeyData = 0;
     size_t cryptoKeySize = 0;
 
@@ -2216,6 +2225,8 @@ status_t ImxExtractor::ParseAudio(uint32 index, uint32 type,uint32 subtype)
     size_t sourceIndex = 0;
     int32_t encoderDelay = 0;
     int32_t encoderPadding = 0;
+    bool isAacAdts = false;
+    bool haveCsd = false;
 
     ALOGD("ParseAudio index=%u,type=%u,subtype=%u",index,type,subtype);
     for(i = 0; i < sizeof(audio_mime_table)/sizeof(codec_mime_struct); i++){
@@ -2241,6 +2252,8 @@ status_t ImxExtractor::ParseAudio(uint32 index, uint32 type,uint32 subtype)
         err = IParser->getDecoderSpecificInfo(parserHandle, index, &decoderSpecificInfo, &decoderSpecificInfoSize);
         if(err)
             return UNKNOWN_ERROR;
+
+        haveCsd = (decoderSpecificInfo && decoderSpecificInfoSize > 0);
     }
 
     err = IParser->getBitRate(parserHandle, index, &bitrate);
@@ -2290,20 +2303,78 @@ status_t ImxExtractor::ParseAudio(uint32 index, uint32 type,uint32 subtype)
     }
 
     AMediaFormat *meta = AMediaFormat_new();
+
+#ifdef USE_IMX_AAC_Dec
     // switch to google.aac.decoder for m4a clips to pass testDecodeM4a, MA-8801
     if(type == AUDIO_AAC && subtype != AUDIO_ER_BSAC && !strcmp(mMime, MEDIA_MIMETYPE_CONTAINER_MPEG4) && mNumTracks == 1) {
         if (FilterM4aFile(mReader->mLength))
             mime = MEDIA_MIMETYPE_AUDIO_AAC_NONSTANDARD;
     }
+#endif
 
     AMediaFormat_setString(meta, AMEDIAFORMAT_KEY_MIME, mime);
     AMediaFormat_setInt32(meta, AMEDIAFORMAT_KEY_TRACK_ID, index);
 
-    if(decoderSpecificInfoSize > 0 && decoderSpecificInfo != NULL){
-        ALOGI("audio codec data size=%u",decoderSpecificInfoSize);
+    if(type == AUDIO_AAC) {
+        // set low-latency = 0 to improve accuracy
+        AMediaFormat_setInt32(meta, AMEDIAFORMAT_KEY_LOW_LATENCY, 0);
+
+        // workaround for avi aac stream, set subtype to ADTS by default if there is no csd
+        if (!strcmp(mMime, MEDIA_MIMETYPE_CONTAINER_AVI) && subtype == 0 && !haveCsd)
+            subtype = AUDIO_AAC_ADTS;
+
+        if(subtype == AUDIO_AAC_ADTS){
+            isAacAdts = true;
+            AMediaFormat_setInt32(meta, AMEDIAFORMAT_KEY_IS_ADTS, 1);
+
+            if (mAdtsBuffer == NULL) {
+                mAdtsBuffer = new ABuffer(MAX_AUDIO_BUFFER_SIZE);
+                mAdtsBuffer->setRange(0, 0);
+            }
+        }else if (subtype == AUDIO_AAC_ADIF){
+            AMediaFormat_setInt32(meta, AMEDIAFORMAT_KEY_IS_ADIF, 1);
+        }
+    }else if(bitrate > 0){
+        AMediaFormat_setInt32(meta, AMEDIAFORMAT_KEY_BIT_RATE, bitrate);
+    }
+
+    if (!haveCsd) {
+        if (type == AUDIO_AAC) {
+            ALOGD("aac stream don't have codec data");
+            sp<MetaData> mFormat = new MetaData;
+            uint32_t type;
+            const void *data;
+            size_t size;
+            unsigned profile = 1, sample_rate_index = 0, channels = channel;
+            switch(samplerate)
+            {
+                case 96000:sample_rate_index = 0;break;
+                case 88200:sample_rate_index = 1;break;
+                case 64000:sample_rate_index = 2;break;
+                case 48000:sample_rate_index = 3;break;
+                case 44100:sample_rate_index = 4;break;
+                case 32000:sample_rate_index = 5;break;
+                case 24000:sample_rate_index = 6;break;
+                case 22050:sample_rate_index = 7;break;
+                case 16000:sample_rate_index = 8;break;
+                case 12000:sample_rate_index = 9;break;
+                case 11025:sample_rate_index = 10;break;
+                case  8000:sample_rate_index = 11;break;
+
+                default:sample_rate_index = 0xff;break;
+            }
+            if (!MakeAACCodecSpecificData(*mFormat, profile, sample_rate_index, channels)) {
+                ALOGW("make aac csd fail");
+            } else if (mFormat->findData(kKeyESDS, &type, &data, &size)) {
+                AMediaFormat_setBuffer(meta, AMEDIAFORMAT_KEY_ESDS, data, size);
+                ALOGI("generate esds metadata for aac, size=%zu", size);
+            }
+        }
+    } else {
+        ALOGI("audio codec data size=%u mAacAdts=%d",decoderSpecificInfoSize, isAacAdts);
         if(type == AUDIO_AAC){
             addESDSFromCodecPrivate(meta,true,decoderSpecificInfo,decoderSpecificInfoSize);
-            ALOGI("add esds metadata for aac audio size=%u",decoderSpecificInfoSize);
+            ALOGI("add esds metadata for aac raw audio size=%u", decoderSpecificInfoSize);
         }else if(type == AUDIO_VORBIS){
             if(OK != addVorbisCodecInfo(meta,decoderSpecificInfo,decoderSpecificInfoSize))
                 ALOGE("add vorbis codec info error");
@@ -2352,6 +2423,9 @@ status_t ImxExtractor::ParseAudio(uint32 index, uint32 type,uint32 subtype)
         const int DSD_BLOCK_SIZE = 4096;
         const int DSD_CHANNEL_NUM_MAX = 6;
         max_size = DSD_BLOCK_SIZE * DSD_CHANNEL_NUM_MAX;
+    }else if(type == AUDIO_FLAC){
+        //enalrte to 32K to pass cts android.mediav2.cts.ExtractorTest$FunctionalityTest#testSeekFlakinessNative[14(audio/flac)]
+        max_size = 32768;
     }
 
     AMediaFormat_setInt32(meta, AMEDIAFORMAT_KEY_MAX_INPUT_SIZE, max_size);
@@ -2379,18 +2453,6 @@ status_t ImxExtractor::ParseAudio(uint32 index, uint32 type,uint32 subtype)
         AMediaFormat_setInt32(meta, AMEDIAFORMAT_KEY_BITS_PER_FRAME, bitsPerFrame);
     }
 
-    if(type == AUDIO_AAC) {
-        // set low-latency = 0 to improve accuracy
-        AMediaFormat_setInt32(meta, AMEDIAFORMAT_KEY_LOW_LATENCY, 0);
-        if(subtype == AUDIO_AAC_ADTS){
-            AMediaFormat_setInt32(meta, AMEDIAFORMAT_KEY_IS_ADTS, 1);
-        }else if (subtype == AUDIO_AAC_ADIF){
-            AMediaFormat_setInt32(meta, AMEDIAFORMAT_KEY_IS_ADIF, 1);
-        }
-    }else if(bitrate > 0){
-        AMediaFormat_setInt32(meta, AMEDIAFORMAT_KEY_BIT_RATE, bitrate);
-    }
-
     if(type == AUDIO_AMR){
         if(subtype == AUDIO_AMR_NB){
             channel = 1;
@@ -2444,6 +2506,7 @@ status_t ImxExtractor::ParseAudio(uint32 index, uint32 type,uint32 subtype)
     trackInfo->bitPerSample = bitPerSample;
     trackInfo->bMp4Encrypted = false;
     trackInfo->bMkvEncrypted = false;
+    trackInfo->bAacAdts = isAacAdts;
 
     void * cryptoKeyData = 0;
     size_t cryptoKeySize = 0;
@@ -2552,8 +2615,9 @@ status_t ImxExtractor::ParseText(uint32 index, uint32 type,uint32 subtype)
     trackInfo->bitPerSample = 0;
     trackInfo->bMkvEncrypted = false;
     trackInfo->bMp4Encrypted = false;
+    trackInfo->bAacAdts = false;
     mReader->AddBufferReadLimitation(index,MAX_TEXT_BUFFER_SIZE);
-    ALOGD("add text track");
+    ALOGI("add text track index=%u,mime=%s",index, mime);
     return OK;
 }
 status_t ImxExtractor::ParseTrackExtMetadata(uint32 index, AMediaFormat *meta)
@@ -2716,17 +2780,12 @@ status_t ImxExtractor::ActiveTrack(uint32 index)
         return UNKNOWN_ERROR;
     trackInfo->bCodecInfoSent = false;
     if(trackInfo->type == MEDIA_VIDEO){
-        seekPos = currentVideoTs;
         mVideoActived = true;
         mVideoIndex = index;
     }else if(trackInfo->type == MEDIA_AUDIO){
-        seekPos = currentAudioTs;
         mAudioActived = true;
         mAudioIndex = index;
-    }else if(currentVideoTs > 0)
-        seekPos = currentVideoTs;
-    else
-        seekPos = currentAudioTs;
+    }
 
     IParser->enableTrack(parserHandle,trackInfo->mTrackNum, TRUE);
 
@@ -2852,6 +2911,12 @@ media_status_t ImxExtractor::HandleSeekOperation(uint32_t index,int64_t * ts,uin
     else if(pInfo->type == MEDIA_AUDIO) {
         currentAudioTs = target;
         bWaitForAudioStartTime = true;
+
+        if (mAdtsBuffer != NULL) {
+            mAdtsBuffer->setRange(0, 0);
+        }
+
+        mResyncAdts = true;
     }
 
     ALOGD("HandleSeekOperation result index=%d,ts=%" PRId64 ",flag=%x",index,*ts,flag);
@@ -3062,6 +3127,25 @@ media_status_t ImxExtractor::GetNextSample(uint32_t index,bool is_sync)
                 }
             }
         }
+
+        if (add) {
+            if (pInfo->type == MEDIA_AUDIO && pInfo->bAacAdts) {
+                // return aac adts by frame
+                MediaBufferHelper *newBuf;
+                size_t size = mAdtsBuffer->size() + pInfo->buffer->range_length();
+                mReader->AcquireBuffer(0, size, &newBuf);
+
+                if (newBuf && (OK == GetAacAdtsFrames(pInfo->buffer, newBuf))) {
+                    pInfo->buffer->release();
+                    pInfo->buffer = newBuf;
+                }
+                else {
+                    add = false;
+                    if (newBuf)
+                        newBuf->release();
+                }
+            }
+        }
         if(add){
             bool readDrmInfo = false;
             //check the last complete sample we read
@@ -3095,7 +3179,7 @@ media_status_t ImxExtractor::GetNextSample(uint32_t index,bool is_sync)
             AMediaFormat_setInt32(meta, AMEDIAFORMAT_KEY_IS_SYNC_FRAME, pInfo->syncFrame);
             AMediaFormat_setInt64(meta, AMEDIAFORMAT_KEY_DURATION,  pInfo->outDuration);
 
-            ALOGV("addMediaBuffer ts=%" PRId64 ",size=%zu",pInfo->outTs,pInfo->buffer->size());
+            ALOGV("addMediaBuffer ts=%" PRId64 ",size=%zu",pInfo->outTs,pInfo->buffer->range_length());
             if(pInfo->bMkvEncrypted){
                 SetMkvCrpytBufferInfo(pInfo,mbuf);
             }else if(pInfo->bMp4Encrypted && readDrmInfo){
@@ -3298,6 +3382,138 @@ status_t ImxExtractor::SetMp4CrpytBufferInfo(TrackInfo *pInfo, MediaBufferHelper
 
     return OK;
 }
+
+static bool getAacAdtsFrameOffset(uint8_t * pData, size_t size,
+                                            size_t *frameBegin, size_t *frameEnd,
+                                            bool *resync)
+{
+    size_t offset = 0;
+    bool findFrame = false;
+
+    *frameBegin = 0;
+    *frameEnd = 0;
+
+    while (offset < size) {
+        if (offset + 7 >= size) {
+            break;
+        }
+
+        ABitReader bits((const uint8_t *)pData + offset, size - offset);
+        unsigned aac_frame_length = 0;
+
+        // adts_fixed_header
+        if (bits.getBits(12) != 0xfffu) {
+            // first frame, it might need to resync because of seek
+            if (!findFrame)
+                goto NEXT_BYTE;
+            else
+                break;
+        }
+
+        // ID, layer, protection_absent
+        // profile_ObjectType, sampling_frequency_index, private_bits,
+        // channel_configuration, original_copy, home
+        // copyright_identification_bit, copyright_identification_start
+        bits.skipBits(18);
+
+        aac_frame_length = bits.getBits(13);
+        if (aac_frame_length == 0){
+            ALOGW("Invalid AAC frame length!");
+            if (!findFrame)
+                goto NEXT_BYTE;
+            else
+                break;
+        }
+
+        bits.skipBits(11);  // adts_buffer_fullness
+
+        // number_of_raw_data_blocks_in_frame
+        if (bits.getBits(2) != 0) {
+            // To be implemented.
+            ALOGW("Should not reach here.");
+            if (!findFrame)
+                goto NEXT_BYTE;
+            else
+                break;
+        }
+
+        if (offset + aac_frame_length > size) {
+            break;
+        }
+
+        if (*resync) {
+            if (offset + aac_frame_length + 2 < size
+                    && (pData[offset + aac_frame_length] != 0xff
+                    || (pData[offset + aac_frame_length + 1 ] >> 4) != 0xf))
+                goto NEXT_BYTE;
+            else
+                *resync = false;
+        }
+
+        if (!findFrame) {
+            findFrame = true;
+            *frameBegin = offset;
+        }
+
+        offset += aac_frame_length;
+        continue;
+
+NEXT_BYTE:
+        ++offset;
+        *frameBegin = offset;
+        continue;
+    }
+
+    if (findFrame) {
+        *frameEnd = offset;
+    } else {
+        *frameEnd = size;
+    }
+
+    ALOGV("AAC ADTS findFrame %d frameBegin %zu frameEnd %zu", findFrame, *frameBegin, *frameEnd);
+    return findFrame;
+}
+
+status_t ImxExtractor::GetAacAdtsFrames(MediaBufferHelper *srcBuf, MediaBufferHelper * dstBuf)
+{
+
+    uint8_t *pData = NULL;
+    size_t size = 0;
+    size_t beginOffset = 0;
+    size_t endOffset = 0;
+    status_t ret = OK;
+
+    if (mAdtsBuffer->size() > 0) {
+        memcpy(dstBuf->data(), mAdtsBuffer->data(), mAdtsBuffer->size());
+        memcpy((uint8_t *)dstBuf->data() + mAdtsBuffer->size(), srcBuf->data(), srcBuf->range_length());
+        size = mAdtsBuffer->size() + srcBuf->range_length();
+        dstBuf->set_range(0, size);
+    } else {
+        memcpy((uint8_t *)dstBuf->data(), srcBuf->data(), srcBuf->range_length());
+        size = srcBuf->range_length();
+        dstBuf->set_range(0, size);
+    }
+
+    pData = (uint8_t *)dstBuf->data();
+    size = dstBuf->range_length();
+    ALOGV("%s AAC ADTS: buffer after resize %zu ", __FUNCTION__, size);
+
+    if (getAacAdtsFrameOffset(pData, size, &beginOffset, &endOffset, &mResyncAdts)) {
+        dstBuf->set_range(beginOffset, endOffset - beginOffset);
+    } else {
+        dstBuf->set_range(0, 0);
+        ret = BAD_VALUE;
+    }
+
+    if (endOffset < size) {
+        memcpy(mAdtsBuffer->data(), pData + endOffset, size - endOffset);
+        mAdtsBuffer->setRange(0, size - endOffset);
+        ALOGV("%s left data size %zu", __FUNCTION__, mAdtsBuffer->size());
+    }
+
+    return ret;
+}
+
 #define DELTA_TIME (24 * 3600 * (66*365 + 17))//seconds passed from Jan,1,1904 to Jan,1,1970
 bool ImxExtractor::ConvertMp4TimeToString(uint64 inTime, String8 *s) {
 
diff --git a/extractor/ImxExtractor.h b/extractor/ImxExtractor.h
old mode 100644
new mode 100755
index 1623b40..23e0ce7
--- a/extractor/ImxExtractor.h
+++ b/extractor/ImxExtractor.h
@@ -181,6 +181,7 @@ private:
         uint8_t default_kid[16];
         int32_t default_EncryptedByteBlock;
         int32_t default_SkipByteBlock;
+        bool bAacAdts;
     };
     Vector<TrackInfo> mTracks;
 
@@ -197,6 +198,9 @@ private:
     bool mAudioActived;
     bool bWaitForAudioStartTime;
 
+    sp<ABuffer> mAdtsBuffer;
+    bool mResyncAdts;
+
     AudioPresentationCollection mAudioPresentations;
 
     bool isLiveStreaming() const;
@@ -221,6 +225,7 @@ private:
     bool ConvertMp4TimeToString(uint64 inTime, String8 *s);
     status_t SetMkvHDRColorInfoMetadata(VideoHDRColorInfo *pInfo, AMediaFormat *meta);
     status_t GetAudioPresentationInfo(uint32_t index);
+    status_t GetAacAdtsFrames(MediaBufferHelper *srcBuf, MediaBufferHelper * dstBuf);
 
     ImxExtractor(const ImxExtractor &);
     ImxExtractor &operator=(const ImxExtractor &);
diff --git a/extractor/ImxInspector.cpp b/extractor/ImxInspector.cpp
index 40a6775..cc6743a 100755
--- a/extractor/ImxInspector.cpp
+++ b/extractor/ImxInspector.cpp
@@ -40,10 +40,12 @@ static std::unordered_map<uint64_t, int32_t> gMp4FilteredFiles = {
     //sinesweepoggmp4.mp4
     //android.media.cts.DecoderTest#testDecodeOggMp4
     {17342,  3},
-    //android.media.cts.MediaMuxerTest#testDualAudioTrack
-    //audio_aac_mono_70kbs_44100hz_aac_mono_70kbs_44100hz.mp4, MediaMuxerTest_testDualAudioxxx.mp4
-    {19916,  4},
-    {20936,  5},
+    //android.media.cts.MediaMetadataRetrieverTest#test3gppMetadata
+    //testvideo.3gp
+    {504045, 5},
+    //android.media.cts.MediaMetadataRetrieverTest#testGetFrameAtTimeClosestEmptyNormalEditList
+    //binary_counter_320x240_30fps_600frames_empty_normal_editlist_entries.mp4
+    {98471,  6},
 };
 
 static std::unordered_map<uint64_t, int32_t> gMkvFilteredFiles = {
@@ -53,6 +55,7 @@ static std::unordered_map<uint64_t, int32_t> gMkvFilteredFiles = {
     {775795, 2},
 };
 
+#ifdef USE_IMX_AAC_PARSER
 static bool TryAACADIFType(char* buffer,size_t len, const char**mime,float *confidence)
 {
     if(len < 4)
@@ -66,6 +69,7 @@ static bool TryAACADIFType(char* buffer,size_t len, const char**mime,float *conf
 
     return false;
 }
+#endif
 
 static bool TryApeType(char* buffer,size_t len, const char** mime,float *confidence)
 {
@@ -97,12 +101,20 @@ static bool TryAviType(char* buffer,size_t len, const char** mime,float *confide
 static bool TryMp4Type(DataSourceHelper *source, const char**mime, float *confidence)
 {
     off64_t size = 0;
+    off64_t kMinOffset = 2048;
     char buffer[12];
 
-    source->getSize(&size);
+    if (OK == source->getSize(&size)) {
+        if(gMp4FilteredFiles.count(size) > 0)
+            return false;
+    }
 
-    if(gMp4FilteredFiles.count(size) > 0)
-        return false;
+    // MA-17770 android.mediav2.cts.ExtractorUnitTest$TestApi#testIfInvalidDataSourceIsRejectedBySetDataSource
+    // read out of DataSource cached data to verify if DataSource is still valid
+    // if readAt return error, then DataSource will enter error state and cached data is cleared.
+    if (source->readAt(kMinOffset, buffer, 1) == -1) {
+        ALOGW("readAt offset(2048) failed");
+    }
 
     if (source->readAt(0, buffer, 12) < 12) {
         ALOGE("TryMp4Type read datasource fail!");
@@ -833,6 +845,8 @@ static bool TryMp3Type(DataSourceHelper *source,const char**mime,float *confiden
 
     return false;
 }
+
+#ifdef USE_IMX_AAC_PARSER
 static bool TryADTSType(DataSourceHelper *source,const char**mime,float *confidence)
 {
     if(DetectAudioTypeBySource(source, true)){
@@ -843,6 +857,7 @@ static bool TryADTSType(DataSourceHelper *source,const char**mime,float *confide
 
     return false;
 }
+#endif
 
 typedef bool (*TRYTYPEFUNC)(char* buffer, size_t len, const char**mime, float *confidence);
 
@@ -852,7 +867,9 @@ static TRYTYPEFUNC TryFunc[] = {
     TryFlvType,
     TryAsfType,
     TryRmvbType,
+#ifdef USE_IMX_AAC_PARSER
     TryAACADIFType,
+#endif
     TryDsfType,
 };
 
@@ -878,8 +895,10 @@ bool SniffIMX(
         return true;
     else if (TryMp3Type(source,(const char**)meta,confidence))
         return true;
+#ifdef USE_IMX_AAC_PARSER
     else if (TryADTSType(source,(const char**)meta,confidence))
         return true;
+#endif
 
     return false;
 }
diff --git a/mediacodec-profile/check_restricted_codec.mk b/mediacodec-profile/check_restricted_codec.mk
new file mode 100755
index 0000000..2f97c68
--- /dev/null
+++ b/mediacodec-profile/check_restricted_codec.mk
@@ -0,0 +1,51 @@
+
+xml_file=$(LOCAL_PATH)/$(SUB_PATH)/$(FILE_NAME)
+
+ifeq ($(shell test -f $(xml_file).xml && echo found), found)
+
+$(info $(shell cp $(xml_file).xml $(xml_file)_temp.xml -f))
+
+ifeq ($(shell grep -c media_codecs_c2_ac3.xml ${xml_file}_temp.xml), 0)
+ifeq ($(shell test -f $(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/fsl_ac3_dec/media_codecs_c2_ac3.xml && echo found), found)
+    $(info $(shell sed -i '/<\/Included>/i\    <Include href=\"media_codecs_c2_ac3.xml\" />' $(xml_file)_temp.xml))
+endif
+endif
+
+ifeq ($(shell grep -c media_codecs_c2_ddp.xml ${xml_file}_temp.xml), 0)
+ifeq ($(shell test -f $(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/fsl_ddp_dec/media_codecs_c2_ddp.xml && echo found), found)
+    $(info $(shell sed -i '/<\/Included>/i\    <Include href=\"media_codecs_c2_ddp.xml\" />' $(xml_file)_temp.xml))
+endif
+endif
+
+ifeq ($(shell grep -c media_codecs_c2_ms.xml ${xml_file}_temp.xml), 0)
+ifeq ($(shell test -f $(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/fsl_ms_codec/media_codecs_c2_ms.xml && echo found), found)
+    $(info $(shell sed -i '/<\/Included>/i\    <Include href=\"media_codecs_c2_ms.xml\" />' $(xml_file)_temp.xml))
+endif
+endif
+
+ifneq ($(findstring $(BOARD_SOC_TYPE),  IMX8MQ IMX8Q),)
+ifeq ($(shell grep -c media_codecs_c2_wmv9.xml ${xml_file}_temp.xml), 0)
+ifeq ($(shell test -f $(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/fsl_ms_codec/media_codecs_c2_wmv9.xml && echo found), found)
+    $(info $(shell sed -i '/<\/Included>/i\    <Include href=\"media_codecs_c2_wmv9.xml\" />' $(xml_file)_temp.xml))
+endif
+endif
+endif
+
+ifeq ($(shell grep -c media_codecs_c2_ra.xml ${xml_file}_temp.xml), 0)
+ifeq ($(shell test -f $(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/fsl_real_dec/media_codecs_c2_ra.xml && echo found), found)
+    $(info $(shell sed -i '/<\/Included>/i\    <Include href=\"media_codecs_c2_ra.xml\" />' $(xml_file)_temp.xml))
+endif
+endif
+
+ifneq ($(findstring $(BOARD_SOC_TYPE),  IMX8MQ IMX8Q),)
+ifeq ($(shell grep -c media_codecs_c2_rv.xml ${xml_file}_temp.xml), 0)
+ifeq ($(shell test -f $(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/fsl_real_dec/media_codecs_c2_rv.xml && echo found), found)
+    $(info $(shell sed -i '/<\/Included>/i\    <Include href=\"media_codecs_c2_rv.xml\" />' $(xml_file)_temp.xml))
+endif
+endif
+endif
+
+else
+    $(warning can't find $(FILE_NAME).xml)
+endif
+
diff --git a/mediacodec-profile/fsl-restricted-codec/media_codecs_template.xml b/mediacodec-profile/fsl-restricted-codec/media_codecs_template.xml
new file mode 100644
index 0000000..4c21354
--- /dev/null
+++ b/mediacodec-profile/fsl-restricted-codec/media_codecs_template.xml
@@ -0,0 +1,20 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<!-- Copyright (C) 2012 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+
+<MediaCodecs>
+    <Decoders>
+    </Decoders>
+</MediaCodecs>
diff --git a/mediacodec-profile/imx7ulp/media_codecs_performance_c2.xml b/mediacodec-profile/imx7ulp/media_codecs_performance_c2.xml
new file mode 100644
index 0000000..6dfd492
--- /dev/null
+++ b/mediacodec-profile/imx7ulp/media_codecs_performance_c2.xml
@@ -0,0 +1,76 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<!-- Copyright 2018 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+
+<!-- Generated file for b1c1 using measurements between PPR1.180531.001 and PD1A.180717.001 -->
+<MediaCodecs>
+    <Encoders>
+       <MediaCodec name="c2.android.h263.encoder" type="video/3gpp" update="true">
+            <Limit name="measured-frame-rate-176x144" range="435-439" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.avc.encoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="159-253" />
+            <Limit name="measured-frame-rate-720x480" range="113-116" />
+            <Limit name="measured-frame-rate-1280x720" range="51-51" />
+            <Limit name="measured-frame-rate-1920x1080" range="23-23" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.hevc.encoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="37-45" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.mpeg4.encoder" type="video/mp4v-es" update="true">
+            <Limit name="measured-frame-rate-176x144" range="544-544" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp8.encoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="127-128" />
+            <Limit name="measured-frame-rate-640x360" range="41-41" />
+            <Limit name="measured-frame-rate-1280x720" range="30-31" />
+            <Limit name="measured-frame-rate-1920x1080" range="14-14" />
+        </MediaCodec>
+    </Encoders>
+    <Decoders>
+        <MediaCodec name="c2.android.h263.decoder" type="video/3gpp" update="true">
+            <Limit name="measured-frame-rate-176x144" range="549-655" />
+            <Limit name="measured-frame-rate-352x288" range="320-388" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.avc.decoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="346-410" />
+            <Limit name="measured-frame-rate-720x480" range="126-142" />
+            <Limit name="measured-frame-rate-1280x720" range="53-53" />
+            <Limit name="measured-frame-rate-1920x1080" range="22-23" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.hevc.decoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-352x288" range="318-319" />
+            <Limit name="measured-frame-rate-640x360" range="172-197" />
+            <Limit name="measured-frame-rate-720x480" range="146-177" />
+            <Limit name="measured-frame-rate-1280x720" range="75-76" />
+            <Limit name="measured-frame-rate-1920x1080" range="40-40" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.mpeg4.decoder" type="video/mp4v-es" update="true">
+            <Limit name="measured-frame-rate-176x144" range="714-865" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp8.decoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="458-512" />
+            <Limit name="measured-frame-rate-640x360" range="145-149" />
+            <Limit name="measured-frame-rate-1280x720" range="35-35" />
+            <Limit name="measured-frame-rate-1920x1080" range="14-14" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp9.decoder" type="video/x-vnd.on2.vp9" update="true">
+            <Limit name="measured-frame-rate-320x180" range="339-368" />
+            <Limit name="measured-frame-rate-640x360" range="162-170" />
+            <Limit name="measured-frame-rate-1280x720" range="66-76" />
+            <Limit name="measured-frame-rate-1920x1080" range="41-42" />
+        </MediaCodec>
+    </Decoders>
+</MediaCodecs>
diff --git a/mediacodec-profile/imx8mm/media_codecs_c2.xml b/mediacodec-profile/imx8mm/media_codecs_c2.xml
new file mode 100644
index 0000000..aa49f91
--- /dev/null
+++ b/mediacodec-profile/imx8mm/media_codecs_c2.xml
@@ -0,0 +1,98 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<!--
+    Copyright (C) 2018 The Android Open Source Project
+
+    Licensed under the Apache License, Version 2.0 (the "License");
+    you may not use this file except in compliance with the License.
+    You may obtain a copy of the License at
+
+     http://www.apache.org/licenses/LICENSE-2.0
+
+    Unless required by applicable law or agreed to in writing, software
+    distributed under the License is distributed on an "AS IS" BASIS,
+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+    See the License for the specific language governing permissions and
+    limitations under the License.
+-->
+
+
+<Included>
+    <Decoders>
+       <MediaCodec name="c2.imx.avc.decoder" type="video/avc" >
+            <Limit name="size" min="48x48" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="1036800" />
+            <Limit name="bitrate" range="1-50000000" />
+            <Limit name="concurrent-instances" max="32" />
+            <Limit name="performance-point-4096x2304" value="28" />
+            <Limit name="performance-point-3840x2160" value="30" />
+            <Limit name="performance-point-1920x1080" value="120" />
+            <Limit name="performance-point-1280x720" value="240" />
+            <Feature name="adaptive-playback" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.hevc.decoder" type="video/hevc" >
+            <Limit name="size" min="144x144" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="2073600" />
+            <Limit name="bitrate" range="1-100000000"/>
+            <Limit name="concurrent-instances" max="32" />
+            <Limit name="performance-point-4096x2304" value="28" />
+            <Limit name="performance-point-3840x2160" value="30" />
+            <Limit name="performance-point-1920x1080" value="120" />
+            <Limit name="performance-point-1280x720" value="240" />
+            <Feature name="adaptive-playback" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.vp8.decoder" type="video/x-vnd.on2.vp8" >
+            <Limit name="size" min="48x48" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-20000000" />
+            <Limit name="concurrent-instances" max="32" />
+            <Limit name="performance-point-1920x1080" value="120" />
+            <Limit name="performance-point-1280x720" value="240" />
+            <Feature name="adaptive-playback" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.vp9.decoder" type="video/x-vnd.on2.vp9" >
+            <Limit name="size" min="72x72" max="1936x1104" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="2073600" />
+            <Limit name="bitrate" range="1-100000000" />
+            <Limit name="concurrent-instances" max="32" />
+            <Limit name="performance-point-1920x1080" value="120" />
+            <Limit name="performance-point-1280x720" value="240" />
+            <Feature name="adaptive-playback" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mp3.decoder.sw" type="audio/mpeg">
+            <Limit name="channel-count" max="2" />
+            <Limit name="sample-rate" ranges="8000,11025,12000,16000,22050,24000,32000,44100,48000" />
+            <Limit name="bitrate" range="4000-448000" />
+        </MediaCodec>
+    </Decoders>
+    <Encoders>
+        <MediaCodec name="c2.imx.avc.encoder" type="video/avc" >
+            <Limit name="size" min="132x96" max="1920x1088" />
+            <Limit name="alignment" value="8x8" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-60000000" />
+            <Limit name="concurrent-instances" max="32" />
+            <Limit name="performance-point-1920x1080" value="30" />
+            <Limit name="performance-point-1280x720" value="60" />
+            <Feature name="intra-refresh" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.vp8.encoder" type="video/x-vnd.on2.vp8" >
+            <Limit name="size" min="132x96" max="1920x1088" />
+            <Limit name="alignment" value="8x8" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-60000000" />
+            <Limit name="concurrent-instances" max="32" />
+            <Limit name="performance-point-1920x1080" value="30" />
+            <Limit name="performance-point-1280x720" value="60" />
+        </MediaCodec>
+    </Encoders>
+</Included>
diff --git a/mediacodec-profile/imx8mm/media_codecs_performance_c2.xml b/mediacodec-profile/imx8mm/media_codecs_performance_c2.xml
new file mode 100644
index 0000000..297b423
--- /dev/null
+++ b/mediacodec-profile/imx8mm/media_codecs_performance_c2.xml
@@ -0,0 +1,113 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<!-- Copyright 2018 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+
+<!-- Generated file for b1c1 using measurements between PPR1.180531.001 and PD1A.180717.001 -->
+<MediaCodecs>
+    <Encoders>
+        <MediaCodec name="c2.imx.vp8.encoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="580-580" />
+            <Limit name="measured-frame-rate-640x360" range="258-258" />
+            <Limit name="measured-frame-rate-1280x720" range="77-77" />
+            <Limit name="measured-frame-rate-1920x1080" range="35-35" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.avc.encoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="568-577" />
+            <Limit name="measured-frame-rate-720x480" range="190-190" />
+            <Limit name="measured-frame-rate-1280x720" range="79-80" />
+            <Limit name="measured-frame-rate-1920x1080" range="36-36" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.hevc.encoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="37-45" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.h263.encoder" type="video/3gpp" update="true">
+            <Limit name="measured-frame-rate-176x144" range="435-439" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.avc.encoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="159-253" />
+            <Limit name="measured-frame-rate-720x480" range="113-116" />
+            <Limit name="measured-frame-rate-1280x720" range="51-51" />
+            <Limit name="measured-frame-rate-1920x1080" range="23-23" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.mpeg4.encoder" type="video/mp4v-es" update="true">
+            <Limit name="measured-frame-rate-176x144" range="544-544" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp8.encoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="127-128" />
+            <Limit name="measured-frame-rate-640x360" range="41-41" />
+            <Limit name="measured-frame-rate-1280x720" range="30-31" />
+            <Limit name="measured-frame-rate-1920x1080" range="14-14" />
+        </MediaCodec>
+    </Encoders>
+    <Decoders>
+        <MediaCodec name="c2.imx.avc.decoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="864-1035" />
+            <Limit name="measured-frame-rate-720x480" range="498-580" />
+            <Limit name="measured-frame-rate-1280x720" range="266-281" />
+            <Limit name="measured-frame-rate-1920x1080" range="130-132" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.vp8.decoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="855-1137" />
+            <Limit name="measured-frame-rate-640x360" range="704-877" />
+            <Limit name="measured-frame-rate-1280x720" range="298-313" />
+            <Limit name="measured-frame-rate-1920x1080" range="141-141" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.vp9.decoder" type="video/x-vnd.on2.vp9" update="true">
+            <Limit name="measured-frame-rate-320x240" range="859-1094" />
+            <Limit name="measured-frame-rate-640x360" range="706-917" />
+            <Limit name="measured-frame-rate-1280x720" range="431-480" />
+            <Limit name="measured-frame-rate-1920x1080" range="291-324" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.hevc.decoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-352x288" range="858-1083" />
+            <Limit name="measured-frame-rate-640x360" range="834-974" />
+            <Limit name="measured-frame-rate-720x480" range="738-856" />
+            <Limit name="measured-frame-rate-1280x720" range="484-580" />
+            <Limit name="measured-frame-rate-1920x1080" range="288-337" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.h263.decoder" type="video/3gpp" update="true">
+            <Limit name="measured-frame-rate-176x144" range="549-655" />
+            <Limit name="measured-frame-rate-352x288" range="320-388" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.avc.decoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="346-410" />
+            <Limit name="measured-frame-rate-720x480" range="126-142" />
+            <Limit name="measured-frame-rate-1280x720" range="53-53" />
+            <Limit name="measured-frame-rate-1920x1080" range="22-23" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.hevc.decoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-352x288" range="318-319" />
+            <Limit name="measured-frame-rate-640x360" range="172-197" />
+            <Limit name="measured-frame-rate-720x480" range="146-177" />
+            <Limit name="measured-frame-rate-1280x720" range="75-76" />
+            <Limit name="measured-frame-rate-1920x1080" range="40-40" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.mpeg4.decoder" type="video/mp4v-es" update="true">
+            <Limit name="measured-frame-rate-176x144" range="714-865" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp8.decoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="458-512" />
+            <Limit name="measured-frame-rate-640x360" range="145-149" />
+            <Limit name="measured-frame-rate-1280x720" range="35-35" />
+            <Limit name="measured-frame-rate-1920x1080" range="14-14" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp9.decoder" type="video/x-vnd.on2.vp9" update="true">
+            <Limit name="measured-frame-rate-320x180" range="339-368" />
+            <Limit name="measured-frame-rate-640x360" range="162-170" />
+            <Limit name="measured-frame-rate-1280x720" range="66-76" />
+            <Limit name="measured-frame-rate-1920x1080" range="41-42" />
+        </MediaCodec>
+    </Decoders>
+</MediaCodecs>
diff --git a/mediacodec-profile/imx8mn/media_codecs_c2.xml b/mediacodec-profile/imx8mn/media_codecs_c2.xml
new file mode 100644
index 0000000..1b36516
--- /dev/null
+++ b/mediacodec-profile/imx8mn/media_codecs_c2.xml
@@ -0,0 +1,27 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<!--
+    Copyright (C) 2018 The Android Open Source Project
+
+    Licensed under the Apache License, Version 2.0 (the "License");
+    you may not use this file except in compliance with the License.
+    You may obtain a copy of the License at
+
+     http://www.apache.org/licenses/LICENSE-2.0
+
+    Unless required by applicable law or agreed to in writing, software
+    distributed under the License is distributed on an "AS IS" BASIS,
+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+    See the License for the specific language governing permissions and
+    limitations under the License.
+-->
+
+
+<Included>
+    <Decoders>
+        <MediaCodec name="c2.imx.mp3.decoder.sw" type="audio/mpeg">
+            <Limit name="channel-count" max="2" />
+            <Limit name="sample-rate" ranges="8000,11025,12000,16000,22050,24000,32000,44100,48000" />
+            <Limit name="bitrate" range="4000-448000" />
+        </MediaCodec>
+    </Decoders>
+</Included>
diff --git a/mediacodec-profile/imx8mn/media_codecs_performance_c2.xml b/mediacodec-profile/imx8mn/media_codecs_performance_c2.xml
new file mode 100644
index 0000000..6dfd492
--- /dev/null
+++ b/mediacodec-profile/imx8mn/media_codecs_performance_c2.xml
@@ -0,0 +1,76 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<!-- Copyright 2018 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+
+<!-- Generated file for b1c1 using measurements between PPR1.180531.001 and PD1A.180717.001 -->
+<MediaCodecs>
+    <Encoders>
+       <MediaCodec name="c2.android.h263.encoder" type="video/3gpp" update="true">
+            <Limit name="measured-frame-rate-176x144" range="435-439" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.avc.encoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="159-253" />
+            <Limit name="measured-frame-rate-720x480" range="113-116" />
+            <Limit name="measured-frame-rate-1280x720" range="51-51" />
+            <Limit name="measured-frame-rate-1920x1080" range="23-23" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.hevc.encoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="37-45" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.mpeg4.encoder" type="video/mp4v-es" update="true">
+            <Limit name="measured-frame-rate-176x144" range="544-544" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp8.encoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="127-128" />
+            <Limit name="measured-frame-rate-640x360" range="41-41" />
+            <Limit name="measured-frame-rate-1280x720" range="30-31" />
+            <Limit name="measured-frame-rate-1920x1080" range="14-14" />
+        </MediaCodec>
+    </Encoders>
+    <Decoders>
+        <MediaCodec name="c2.android.h263.decoder" type="video/3gpp" update="true">
+            <Limit name="measured-frame-rate-176x144" range="549-655" />
+            <Limit name="measured-frame-rate-352x288" range="320-388" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.avc.decoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="346-410" />
+            <Limit name="measured-frame-rate-720x480" range="126-142" />
+            <Limit name="measured-frame-rate-1280x720" range="53-53" />
+            <Limit name="measured-frame-rate-1920x1080" range="22-23" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.hevc.decoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-352x288" range="318-319" />
+            <Limit name="measured-frame-rate-640x360" range="172-197" />
+            <Limit name="measured-frame-rate-720x480" range="146-177" />
+            <Limit name="measured-frame-rate-1280x720" range="75-76" />
+            <Limit name="measured-frame-rate-1920x1080" range="40-40" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.mpeg4.decoder" type="video/mp4v-es" update="true">
+            <Limit name="measured-frame-rate-176x144" range="714-865" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp8.decoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="458-512" />
+            <Limit name="measured-frame-rate-640x360" range="145-149" />
+            <Limit name="measured-frame-rate-1280x720" range="35-35" />
+            <Limit name="measured-frame-rate-1920x1080" range="14-14" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp9.decoder" type="video/x-vnd.on2.vp9" update="true">
+            <Limit name="measured-frame-rate-320x180" range="339-368" />
+            <Limit name="measured-frame-rate-640x360" range="162-170" />
+            <Limit name="measured-frame-rate-1280x720" range="66-76" />
+            <Limit name="measured-frame-rate-1920x1080" range="41-42" />
+        </MediaCodec>
+    </Decoders>
+</MediaCodecs>
diff --git a/mediacodec-profile/imx8mp/media_codecs_c2.xml b/mediacodec-profile/imx8mp/media_codecs_c2.xml
new file mode 100644
index 0000000..b37d35a
--- /dev/null
+++ b/mediacodec-profile/imx8mp/media_codecs_c2.xml
@@ -0,0 +1,101 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<!--
+    Copyright (C) 2018 The Android Open Source Project
+
+    Licensed under the Apache License, Version 2.0 (the "License");
+    you may not use this file except in compliance with the License.
+    You may obtain a copy of the License at
+
+     http://www.apache.org/licenses/LICENSE-2.0
+
+    Unless required by applicable law or agreed to in writing, software
+    distributed under the License is distributed on an "AS IS" BASIS,
+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+    See the License for the specific language governing permissions and
+    limitations under the License.
+-->
+
+
+<Included>
+    <Include href="media_codecs_c2_dsp_aacp.xml" />
+    <Include href="media_codecs_c2_dsp_wma.xml" />
+    <Include href="media_codecs_c2_dsp.xml" />
+    <Decoders>
+       <MediaCodec name="c2.imx.avc.decoder" type="video/avc" >
+            <Limit name="size" min="48x48" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="1036800" />
+            <Limit name="bitrate" range="1-50000000" />
+            <Limit name="concurrent-instances" max="32" />
+            <Limit name="performance-point-4096x2304" value="28" />
+            <Limit name="performance-point-3840x2160" value="30" />
+            <Limit name="performance-point-1920x1080" value="120" />
+            <Limit name="performance-point-1280x720" value="240" />
+            <Feature name="adaptive-playback" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.hevc.decoder" type="video/hevc" >
+            <Limit name="size" min="144x144" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="2073600" />
+            <Limit name="bitrate" range="1-100000000"/>
+            <Limit name="concurrent-instances" max="32" />
+            <Limit name="performance-point-4096x2304" value="28" />
+            <Limit name="performance-point-3840x2160" value="30" />
+            <Limit name="performance-point-1920x1080" value="120" />
+            <Limit name="performance-point-1280x720" value="240" />
+            <Feature name="adaptive-playback" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.vp8.decoder" type="video/x-vnd.on2.vp8" >
+            <Limit name="size" min="48x48" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-20000000" />
+            <Limit name="concurrent-instances" max="32" />
+            <Limit name="performance-point-1920x1080" value="120" />
+            <Limit name="performance-point-1280x720" value="240" />
+            <Feature name="adaptive-playback" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.vp9.decoder" type="video/x-vnd.on2.vp9" >
+            <Limit name="size" min="72x72" max="1936x1104" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="2073600" />
+            <Limit name="bitrate" range="1-100000000" />
+            <Limit name="concurrent-instances" max="32" />
+            <Limit name="performance-point-1920x1080" value="120" />
+            <Limit name="performance-point-1280x720" value="240" />
+            <Feature name="adaptive-playback" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mp3.decoder.sw" type="audio/mpeg">
+            <Limit name="channel-count" max="2" />
+            <Limit name="sample-rate" ranges="8000,11025,12000,16000,22050,24000,32000,44100,48000" />
+            <Limit name="bitrate" range="4000-448000" />
+        </MediaCodec>
+    </Decoders>
+    <Encoders>
+        <MediaCodec name="c2.imx.avc.encoder" type="video/avc" >
+            <Limit name="size" min="132x96" max="1920x1088" />
+            <Limit name="alignment" value="4x4" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-60000000" />
+            <Limit name="concurrent-instances" max="32" />
+            <Limit name="performance-point-1920x1080" value="30" />
+            <Limit name="performance-point-1280x720" value="60" />
+            <Feature name="intra-refresh" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.hevc.encoder" type="video/hevc" >
+            <Limit name="size" min="132x96" max="1920x1088" />
+            <Limit name="alignment" value="8x8" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-60000000" />
+            <Limit name="concurrent-instances" max="32" />
+            <Limit name="performance-point-1920x1080" value="30" />
+            <Limit name="performance-point-1280x720" value="60" />
+        </MediaCodec>
+    </Encoders>
+</Included>
diff --git a/mediacodec-profile/imx8mp/media_codecs_performance_c2.xml b/mediacodec-profile/imx8mp/media_codecs_performance_c2.xml
new file mode 100644
index 0000000..2417675
--- /dev/null
+++ b/mediacodec-profile/imx8mp/media_codecs_performance_c2.xml
@@ -0,0 +1,113 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<!-- Copyright 2018 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+
+<!-- Generated file for b1c1 using measurements between PPR1.180531.001 and PD1A.180717.001 -->
+<MediaCodecs>
+    <Encoders>
+        <MediaCodec name="c2.imx.hevc.encoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-320x180" range="580-580" />
+            <Limit name="measured-frame-rate-640x360" range="258-258" />
+            <Limit name="measured-frame-rate-1280x720" range="77-77" />
+            <Limit name="measured-frame-rate-1920x1080" range="35-35" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.avc.encoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="568-577" />
+            <Limit name="measured-frame-rate-720x480" range="190-190" />
+            <Limit name="measured-frame-rate-1280x720" range="79-80" />
+            <Limit name="measured-frame-rate-1920x1080" range="36-36" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.h263.encoder" type="video/3gpp" update="true">
+            <Limit name="measured-frame-rate-176x144" range="435-439" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.avc.encoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="159-253" />
+            <Limit name="measured-frame-rate-720x480" range="113-116" />
+            <Limit name="measured-frame-rate-1280x720" range="51-51" />
+            <Limit name="measured-frame-rate-1920x1080" range="23-23" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.hevc.encoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="37-45" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.mpeg4.encoder" type="video/mp4v-es" update="true">
+            <Limit name="measured-frame-rate-176x144" range="544-544" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp8.encoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="127-128" />
+            <Limit name="measured-frame-rate-640x360" range="41-41" />
+            <Limit name="measured-frame-rate-1280x720" range="13-13" />
+            <Limit name="measured-frame-rate-1920x1080" range="14-14" />
+        </MediaCodec>
+    </Encoders>
+    <Decoders>
+        <MediaCodec name="c2.imx.avc.decoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="864-1035" />
+            <Limit name="measured-frame-rate-720x480" range="498-580" />
+            <Limit name="measured-frame-rate-1280x720" range="266-281" />
+            <Limit name="measured-frame-rate-1920x1080" range="130-132" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.vp8.decoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="855-1137" />
+            <Limit name="measured-frame-rate-640x360" range="704-877" />
+            <Limit name="measured-frame-rate-1280x720" range="298-313" />
+            <Limit name="measured-frame-rate-1920x1080" range="141-141" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.vp9.decoder" type="video/x-vnd.on2.vp9" update="true">
+            <Limit name="measured-frame-rate-320x240" range="859-1094" />
+            <Limit name="measured-frame-rate-640x360" range="706-917" />
+            <Limit name="measured-frame-rate-1280x720" range="431-480" />
+            <Limit name="measured-frame-rate-1920x1080" range="291-324" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.hevc.decoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-352x288" range="858-1083" />
+            <Limit name="measured-frame-rate-640x360" range="834-974" />
+            <Limit name="measured-frame-rate-720x480" range="738-856" />
+            <Limit name="measured-frame-rate-1280x720" range="484-580" />
+            <Limit name="measured-frame-rate-1920x1080" range="288-337" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.h263.decoder" type="video/3gpp" update="true">
+            <Limit name="measured-frame-rate-176x144" range="549-655" />
+            <Limit name="measured-frame-rate-352x288" range="320-388" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.avc.decoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="346-410" />
+            <Limit name="measured-frame-rate-720x480" range="126-142" />
+            <Limit name="measured-frame-rate-1280x720" range="53-53" />
+            <Limit name="measured-frame-rate-1920x1080" range="22-23" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.hevc.decoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-352x288" range="318-319" />
+            <Limit name="measured-frame-rate-640x360" range="172-197" />
+            <Limit name="measured-frame-rate-720x480" range="146-177" />
+            <Limit name="measured-frame-rate-1280x720" range="75-76" />
+            <Limit name="measured-frame-rate-1920x1080" range="40-40" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.mpeg4.decoder" type="video/mp4v-es" update="true">
+            <Limit name="measured-frame-rate-176x144" range="714-865" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp8.decoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="458-512" />
+            <Limit name="measured-frame-rate-640x360" range="145-149" />
+            <Limit name="measured-frame-rate-1280x720" range="35-35" />
+            <Limit name="measured-frame-rate-1920x1080" range="14-14" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp9.decoder" type="video/x-vnd.on2.vp9" update="true">
+            <Limit name="measured-frame-rate-320x180" range="339-368" />
+            <Limit name="measured-frame-rate-640x360" range="162-170" />
+            <Limit name="measured-frame-rate-1280x720" range="66-76" />
+            <Limit name="measured-frame-rate-1920x1080" range="41-42" />
+        </MediaCodec>
+    </Decoders>
+</MediaCodecs>
diff --git a/mediacodec-profile/imx8mq/media_codecs_c2.xml b/mediacodec-profile/imx8mq/media_codecs_c2.xml
new file mode 100644
index 0000000..11a1802
--- /dev/null
+++ b/mediacodec-profile/imx8mq/media_codecs_c2.xml
@@ -0,0 +1,127 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<!--
+    Copyright (C) 2018 The Android Open Source Project
+
+    Licensed under the Apache License, Version 2.0 (the "License");
+    you may not use this file except in compliance with the License.
+    You may obtain a copy of the License at
+
+     http://www.apache.org/licenses/LICENSE-2.0
+
+    Unless required by applicable law or agreed to in writing, software
+    distributed under the License is distributed on an "AS IS" BASIS,
+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+    See the License for the specific language governing permissions and
+    limitations under the License.
+-->
+
+
+<Included>
+    <Decoders>
+       <MediaCodec name="c2.imx.avc.decoder" type="video/avc" >
+            <Limit name="size" min="64x64" max="4096x2160" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="1036800" />
+            <Limit name="bitrate" range="1-50000000" />
+            <Limit name="concurrent-instances" max="32" />
+            <Limit name="performance-point-4096x2304" value="28" />
+            <Limit name="performance-point-3840x2160" value="30" />
+            <Limit name="performance-point-1920x1080" value="120" />
+            <Limit name="performance-point-1280x720" value="240" />
+            <Feature name="adaptive-playback" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.hevc.decoder" type="video/hevc" >
+            <Limit name="size" min="144x144" max="4096x2160" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="2073600" />
+            <Limit name="bitrate" range="1-100000000"/>
+            <Limit name="concurrent-instances" max="32" />
+            <Limit name="performance-point-4096x2304" value="28" />
+            <Limit name="performance-point-3840x2160" value="30" />
+            <Limit name="performance-point-1920x1080" value="120" />
+            <Limit name="performance-point-1280x720" value="240" />
+            <Feature name="adaptive-playback" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.vp8.decoder" type="video/x-vnd.on2.vp8" >
+            <Limit name="size" min="48x48" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-20000000" />
+            <Limit name="concurrent-instances" max="32" />
+            <Limit name="performance-point-1920x1080" value="120" />
+            <Limit name="performance-point-1280x720" value="240" />
+            <Feature name="adaptive-playback" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.vp9.decoder" type="video/x-vnd.on2.vp9" >
+            <Limit name="size" min="96x72" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="2073600" />
+            <Limit name="bitrate" range="1-100000000" />
+            <Limit name="concurrent-instances" max="32" />
+            <Limit name="performance-point-1920x1080" value="120" />
+            <Limit name="performance-point-1280x720" value="240" />
+            <Feature name="adaptive-playback" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.h263.decoder" type="video/3gpp" >
+            <Limit name="size" min="48x48" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="bitrate" range="1-20000000" />
+            <Limit name="concurrent-instances" max="32" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mpeg4.decoder" type="video/mp4v-es" >
+            <Limit name="size" min="48x48" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-40000000" />
+            <Limit name="concurrent-instances" max="32" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mpeg2.decoder" type="video/mpeg2" >
+            <Limit name="size" min="48x48" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-20000000"/>
+            <Limit name="concurrent-instances" max="32" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.xvid.decoder" type="video/xvid" >
+            <Limit name="size" min="64x64" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-20000000"/>
+            <Limit name="concurrent-instances" max="32" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mjpeg.decoder" type="video/x-motion-jpeg" >
+            <Limit name="size" min="48x48" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-20000000"/>
+            <Limit name="concurrent-instances" max="32" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mp3.decoder.sw" type="audio/mpeg">
+            <Limit name="channel-count" max="2" />
+            <Limit name="sample-rate" ranges="8000,11025,12000,16000,22050,24000,32000,44100,48000" />
+            <Limit name="bitrate" range="4000-448000" />
+        </MediaCodec>
+    </Decoders>
+</Included>
diff --git a/mediacodec-profile/imx8mq/media_codecs_performance_c2.xml b/mediacodec-profile/imx8mq/media_codecs_performance_c2.xml
new file mode 100644
index 0000000..7e4b856
--- /dev/null
+++ b/mediacodec-profile/imx8mq/media_codecs_performance_c2.xml
@@ -0,0 +1,114 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<!-- Copyright 2018 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+
+<!-- Generated file for b1c1 using measurements between PPR1.180531.001 and PD1A.180717.001 -->
+<MediaCodecs>
+    <Encoders>
+        <MediaCodec name="c2.android.h263.encoder" type="video/3gpp" update="true">
+            <Limit name="measured-frame-rate-176x144" range="152-159" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.avc.encoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="198-198" />
+            <Limit name="measured-frame-rate-720x480" range="57-57" />
+            <Limit name="measured-frame-rate-1280x720" range="18-18" />
+            <Limit name="measured-frame-rate-1920x1080" range="7-8" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.hevc.encoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="37-45" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.mpeg4.encoder" type="video/mp4v-es" update="true">
+            <Limit name="measured-frame-rate-176x144" range="171-171" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp8.encoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="49-53" />
+            <Limit name="measured-frame-rate-640x360" range="35-35" />
+            <Limit name="measured-frame-rate-1280x720" range="12-13" />
+            <Limit name="measured-frame-rate-1920x1080" range="5-5" />
+        </MediaCodec>
+    </Encoders>
+    <Decoders>
+        <MediaCodec name="c2.imx.h263.decoder" type="video/3gpp" update="true">
+            <Limit name="measured-frame-rate-192x144" range="1221-1293" />
+            <Limit name="measured-frame-rate-352x288" range="1261-1331" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.avc.decoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="831-1165" />
+            <Limit name="measured-frame-rate-720x480" range="556-575" />
+            <Limit name="measured-frame-rate-1280x720" range="299-306" />
+            <Limit name="measured-frame-rate-1920x1080" range="138-138" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mpeg4.decoder" type="video/mp4v-es" update="true">
+            <Limit name="measured-frame-rate-176x144" range="1286-1294" />
+            <Limit name="measured-frame-rate-480x360" range="1138-1164" />
+            <Limit name="measured-frame-rate-1280x720" range="168-168" />
+            <Limit name="measured-frame-rate-1920x1080" range="70-70" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.vp8.decoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="1064-1084" />
+            <Limit name="measured-frame-rate-640x360" range="863-956" />
+            <Limit name="measured-frame-rate-1280x720" range="332-335" />
+            <Limit name="measured-frame-rate-1920x1080" range="150-150" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.vp9.decoder" type="video/x-vnd.on2.vp9" update="true">
+            <Limit name="measured-frame-rate-320x240" range="805-817" />
+            <Limit name="measured-frame-rate-640x360" range="757-767" />
+            <Limit name="measured-frame-rate-1280x720" range="546-551" />
+            <Limit name="measured-frame-rate-1920x1080" range="364-365" />
+            <Limit name="measured-frame-rate-3840x2160" range="87-87" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.hevc.decoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-352x288" range="733-816" />
+            <Limit name="measured-frame-rate-640x360" range="731-734" />
+            <Limit name="measured-frame-rate-720x480" range="694-714" />
+            <Limit name="measured-frame-rate-1280x720" range="550-561" />
+            <Limit name="measured-frame-rate-1920x1080" range="330-335" />
+            <Limit name="measured-frame-rate-3840x2160" range="98-98" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.h263.decoder" type="video/3gpp" update="true">
+            <Limit name="measured-frame-rate-176x144" range="440-461" />
+            <Limit name="measured-frame-rate-352x288" range="286-293" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.avc.decoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="139-146" />
+            <Limit name="measured-frame-rate-720x480" range="120-120" />
+            <Limit name="measured-frame-rate-1280x720" range="48-48" />
+            <Limit name="measured-frame-rate-1920x1080" range="20-20" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.hevc.decoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-352x288" range="153-157" />
+            <Limit name="measured-frame-rate-640x360" range="140-145" />
+            <Limit name="measured-frame-rate-720x480" range="130-135" />
+            <Limit name="measured-frame-rate-1280x720" range="60-61" />
+            <Limit name="measured-frame-rate-1920x1080" range="39-40" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.mpeg4.decoder" type="video/mp4v-es" update="true">
+            <Limit name="measured-frame-rate-176x144" range="570-577" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp8.decoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="296-297" />
+            <Limit name="measured-frame-rate-640x360" range="97-98" />
+            <Limit name="measured-frame-rate-1280x720" range="23-24" />
+            <Limit name="measured-frame-rate-1920x1080" range="9-9" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp9.decoder" type="video/x-vnd.on2.vp9" update="true">
+            <Limit name="measured-frame-rate-320x180" range="188-192" />
+            <Limit name="measured-frame-rate-640x360" range="125-130" />
+            <Limit name="measured-frame-rate-1280x720" range="60-63" />
+            <Limit name="measured-frame-rate-1920x1080" range="37-37" />
+        </MediaCodec>
+    </Decoders>
+</MediaCodecs>
+
diff --git a/mediacodec-profile/imx8q/media_codecs_8qm.xml b/mediacodec-profile/imx8q/media_codecs_8qm.xml
new file mode 100644
index 0000000..d695559
--- /dev/null
+++ b/mediacodec-profile/imx8q/media_codecs_8qm.xml
@@ -0,0 +1,144 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<!--
+    Copyright (C) 2018 The Android Open Source Project
+
+    Licensed under the Apache License, Version 2.0 (the "License");
+    you may not use this file except in compliance with the License.
+    You may obtain a copy of the License at
+
+     http://www.apache.org/licenses/LICENSE-2.0
+
+    Unless required by applicable law or agreed to in writing, software
+    distributed under the License is distributed on an "AS IS" BASIS,
+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+    See the License for the specific language governing permissions and
+    limitations under the License.
+-->
+
+
+<Included>
+    <Include href="media_codecs_c2_dsp_aacp.xml" />
+    <Include href="media_codecs_c2_dsp_wma.xml" />
+    <Include href="media_codecs_c2_dsp.xml" />
+    <Decoders>
+       <MediaCodec name="c2.imx.avc.decoder" type="video/avc" >
+            <Limit name="size" min="64x64" max="4096x2560" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="1036800" />
+            <Limit name="bitrate" range="1-50000000" />
+            <Limit name="concurrent-instances" max="8" />
+            <Limit name="performance-point-4096x2304" value="28" />
+            <Limit name="performance-point-3840x2160" value="30" />
+            <Limit name="performance-point-1920x1080" value="120" />
+            <Limit name="performance-point-1280x720" value="240" />
+            <Feature name="adaptive-playback" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.hevc.decoder" type="video/hevc" >
+            <Limit name="size" min="144x144" max="4096x2560" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="2073600" />
+            <Limit name="bitrate" range="1-50000000" />
+            <Limit name="concurrent-instances" max="8" />
+            <Limit name="performance-point-4096x2304" value="56" />
+            <Limit name="performance-point-3840x2160" value="60" />
+            <Limit name="performance-point-1920x1080" value="240" />
+            <Feature name="adaptive-playback" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mpeg4.decoder" type="video/mp4v-es" >
+            <Limit name="size" min="64x64" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-40000000" />
+            <Limit name="concurrent-instances" max="8" />
+            <Feature name="adaptive-playback" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mpeg2.decoder" type="video/mpeg2" >
+            <Limit name="size" min="64x64" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-20000000"/>
+            <Limit name="concurrent-instances" max="8" />
+            <Feature name="adaptive-playback" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.h263.decoder" type="video/3gpp" >
+            <Limit name="size" min="64x64" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-40000000" />
+            <Limit name="concurrent-instances" max="8" />
+            <Feature name="adaptive-playback" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.vp8.decoder" type="video/x-vnd.on2.vp8" >
+            <Limit name="size" min="64x64" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-40000000" />
+            <Limit name="concurrent-instances" max="8" />
+            <Feature name="adaptive-playback" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mjpeg.decoder" type="video/x-motion-jpeg" >
+            <Limit name="size" min="48x48" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-20000000"/>
+            <Limit name="concurrent-instances" max="8" />
+            <Feature name="adaptive-playback" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.sorenson.decoder" type="video/x-flash-video" >
+            <Limit name="size" min="48x48" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-20000000"/>
+            <Limit name="concurrent-instances" max="8" />
+            <Feature name="adaptive-playback" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.xvid.decoder" type="video/xvid" >
+            <Limit name="size" min="64x64" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-20000000"/>
+            <Limit name="concurrent-instances" max="8" />
+            <Feature name="adaptive-playback" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mp3.decoder.sw" type="audio/mpeg">
+            <Limit name="channel-count" max="2" />
+            <Limit name="sample-rate" ranges="8000,11025,12000,16000,22050,24000,32000,44100,48000" />
+            <Limit name="bitrate" range="4000-448000" />
+        </MediaCodec>
+    </Decoders>
+    <Encoders>
+        <MediaCodec name="c2.imx.avc.encoder" type="video/avc" >
+            <Limit name="size" min="128x128" max="1920x1088" />
+            <Limit name="alignment" value="16x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="224800" />
+            <Limit name="bitrate" range="1-20000000" />
+            <Limit name="concurrent-instances" max="16" />
+            <Limit name="performance-point-1920x1080" value="30" />
+            <Limit name="performance-point-1280x720" value="60" />
+        </MediaCodec>
+    </Encoders>
+</Included>
diff --git a/mediacodec-profile/imx8q/media_codecs_8qxp.xml b/mediacodec-profile/imx8q/media_codecs_8qxp.xml
new file mode 100644
index 0000000..775e92f
--- /dev/null
+++ b/mediacodec-profile/imx8q/media_codecs_8qxp.xml
@@ -0,0 +1,144 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<!--
+    Copyright (C) 2018 The Android Open Source Project
+
+    Licensed under the Apache License, Version 2.0 (the "License");
+    you may not use this file except in compliance with the License.
+    You may obtain a copy of the License at
+
+     http://www.apache.org/licenses/LICENSE-2.0
+
+    Unless required by applicable law or agreed to in writing, software
+    distributed under the License is distributed on an "AS IS" BASIS,
+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+    See the License for the specific language governing permissions and
+    limitations under the License.
+-->
+
+
+<Included>
+    <Include href="media_codecs_c2_dsp_aacp.xml" />
+    <Include href="media_codecs_c2_dsp_wma.xml" />
+    <Include href="media_codecs_c2_dsp.xml" />
+    <Decoders>
+       <MediaCodec name="c2.imx.avc.decoder" type="video/avc" >
+            <Limit name="size" min="64x64" max="4096x2560" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="1036800" />
+            <Limit name="bitrate" range="1-50000000" />
+            <Limit name="concurrent-instances" max="8" />
+            <Limit name="performance-point-4096x2304" value="28" />
+            <Limit name="performance-point-3840x2160" value="30" />
+            <Limit name="performance-point-1920x1080" value="120" />
+            <Limit name="performance-point-1280x720" value="240" />
+            <Feature name="adaptive-playback" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.hevc.decoder" type="video/hevc" >
+            <Limit name="size" min="144x144" max="4096x2560" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="2073600" />
+            <Limit name="bitrate" range="1-50000000" />
+            <Limit name="concurrent-instances" max="8" />
+            <Limit name="performance-point-4096x2304" value="56" />
+            <Limit name="performance-point-3840x2160" value="60" />
+            <Limit name="performance-point-1920x1080" value="240" />
+            <Feature name="adaptive-playback" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mpeg4.decoder" type="video/mp4v-es" >
+            <Limit name="size" min="64x64" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-40000000" />
+            <Limit name="concurrent-instances" max="8" />
+            <Feature name="adaptive-playback" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mpeg2.decoder" type="video/mpeg2" >
+            <Limit name="size" min="64x64" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-20000000"/>
+            <Limit name="concurrent-instances" max="8" />
+            <Feature name="adaptive-playback" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.h263.decoder" type="video/3gpp" >
+            <Limit name="size" min="64x64" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-40000000" />
+            <Limit name="concurrent-instances" max="8" />
+            <Feature name="adaptive-playback" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.vp8.decoder" type="video/x-vnd.on2.vp8" >
+            <Limit name="size" min="64x64" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-40000000" />
+            <Limit name="concurrent-instances" max="8" />
+            <Feature name="adaptive-playback" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mjpeg.decoder" type="video/x-motion-jpeg" >
+            <Limit name="size" min="48x48" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-20000000"/>
+            <Limit name="concurrent-instances" max="8" />
+            <Feature name="adaptive-playback" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.sorenson.decoder" type="video/x-flash-video" >
+            <Limit name="size" min="48x48" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-20000000"/>
+            <Limit name="concurrent-instances" max="8" />
+            <Feature name="adaptive-playback" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.xvid.decoder" type="video/xvid" >
+            <Limit name="size" min="64x64" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-20000000"/>
+            <Limit name="concurrent-instances" max="8" />
+            <Feature name="adaptive-playback" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mp3.decoder.sw" type="audio/mpeg">
+            <Limit name="channel-count" max="2" />
+            <Limit name="sample-rate" ranges="8000,11025,12000,16000,22050,24000,32000,44100,48000" />
+            <Limit name="bitrate" range="4000-448000" />
+        </MediaCodec>
+    </Decoders>
+    <Encoders>
+        <MediaCodec name="c2.imx.avc.encoder" type="video/avc" >
+            <Limit name="size" min="128x128" max="1920x1088" />
+            <Limit name="alignment" value="16x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="224800" />
+            <Limit name="bitrate" range="1-20000000" />
+            <Limit name="concurrent-instances" max="8" />
+            <Limit name="performance-point-1920x1080" value="30" />
+            <Limit name="performance-point-1280x720" value="60" />
+        </MediaCodec>
+    </Encoders>
+</Included>
diff --git a/mediacodec-profile/imx8q/media_codecs_c2.xml b/mediacodec-profile/imx8q/media_codecs_c2.xml
new file mode 100644
index 0000000..47f7181
--- /dev/null
+++ b/mediacodec-profile/imx8q/media_codecs_c2.xml
@@ -0,0 +1,144 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<!--
+    Copyright (C) 2018 The Android Open Source Project
+
+    Licensed under the Apache License, Version 2.0 (the "License");
+    you may not use this file except in compliance with the License.
+    You may obtain a copy of the License at
+
+     http://www.apache.org/licenses/LICENSE-2.0
+
+    Unless required by applicable law or agreed to in writing, software
+    distributed under the License is distributed on an "AS IS" BASIS,
+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+    See the License for the specific language governing permissions and
+    limitations under the License.
+-->
+
+
+<Included>
+    <Include href="media_codecs_c2_dsp_aacp.xml" />
+    <Include href="media_codecs_c2_dsp_wma.xml" />
+    <Include href="media_codecs_c2_dsp.xml" />
+    <Decoders>
+       <MediaCodec name="c2.imx.avc.decoder" type="video/avc" >
+            <Limit name="size" min="64x64" max="4096x2560" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="1036800" />
+            <Limit name="bitrate" range="1-50000000" />
+            <Limit name="concurrent-instances" max="8" />
+            <Limit name="performance-point-4096x2304" value="28" />
+            <Limit name="performance-point-3840x2160" value="30" />
+            <Limit name="performance-point-1920x1080" value="120" />
+            <Limit name="performance-point-1280x720" value="240" />
+            <Feature name="adaptive-playback" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.hevc.decoder" type="video/hevc" >
+            <Limit name="size" min="144x144" max="4096x2160" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="2073600" />
+            <Limit name="bitrate" range="1-50000000" />
+            <Limit name="concurrent-instances" max="8" />
+            <Limit name="performance-point-4096x2304" value="56" />
+            <Limit name="performance-point-3840x2160" value="60" />
+            <Limit name="performance-point-1920x1080" value="240" />
+            <Feature name="adaptive-playback" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mpeg4.decoder" type="video/mp4v-es" >
+            <Limit name="size" min="64x64" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-40000000" />
+            <Limit name="concurrent-instances" max="8" />
+            <Feature name="adaptive-playback" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mpeg2.decoder" type="video/mpeg2" >
+            <Limit name="size" min="64x64" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-20000000"/>
+            <Limit name="concurrent-instances" max="8" />
+            <Feature name="adaptive-playback" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.h263.decoder" type="video/3gpp" >
+            <Limit name="size" min="64x64" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-40000000" />
+            <Limit name="concurrent-instances" max="8" />
+            <Feature name="adaptive-playback" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.vp8.decoder" type="video/x-vnd.on2.vp8" >
+            <Limit name="size" min="64x64" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-40000000" />
+            <Limit name="concurrent-instances" max="8" />
+            <Feature name="adaptive-playback" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mjpeg.decoder" type="video/x-motion-jpeg" >
+            <Limit name="size" min="48x48" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-20000000"/>
+            <Limit name="concurrent-instances" max="8" />
+            <Feature name="adaptive-playback" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.sorenson.decoder" type="video/x-flash-video" >
+            <Limit name="size" min="48x48" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-20000000"/>
+            <Limit name="concurrent-instances" max="8" />
+            <Feature name="adaptive-playback" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.xvid.decoder" type="video/xvid" >
+            <Limit name="size" min="64x64" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="244800" />
+            <Limit name="bitrate" range="1-20000000"/>
+            <Limit name="concurrent-instances" max="8" />
+            <Feature name="adaptive-playback" />
+            <Limit name="performance-point-1920x1080" value="60" />
+            <Limit name="performance-point-1280x720" value="100" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mp3.decoder.sw" type="audio/mpeg">
+            <Limit name="channel-count" max="2" />
+            <Limit name="sample-rate" ranges="8000,11025,12000,16000,22050,24000,32000,44100,48000" />
+            <Limit name="bitrate" range="4000-448000" />
+        </MediaCodec>
+    </Decoders>
+    <Encoders>
+        <MediaCodec name="c2.imx.avc.encoder" type="video/avc" >
+            <Limit name="size" min="128x128" max="1920x1088" />
+            <Limit name="alignment" value="16x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="224800" />
+            <Limit name="bitrate" range="1-20000000" />
+            <Limit name="concurrent-instances" max="8" />
+            <Limit name="performance-point-1920x1080" value="30" />
+            <Limit name="performance-point-1280x720" value="60" />
+        </MediaCodec>
+    </Encoders>
+</Included>
diff --git a/mediacodec-profile/imx8q/media_codecs_performance_c2.xml b/mediacodec-profile/imx8q/media_codecs_performance_c2.xml
new file mode 100644
index 0000000..7d4d454
--- /dev/null
+++ b/mediacodec-profile/imx8q/media_codecs_performance_c2.xml
@@ -0,0 +1,113 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<!-- Copyright 2018 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+
+<!-- Generated file for b1c1 using measurements between PPR1.180531.001 and PD1A.180717.001 -->
+<MediaCodecs>
+    <Encoders>
+        <MediaCodec name="c2.android.h263.encoder" type="video/3gpp" update="true">
+            <Limit name="measured-frame-rate-176x144" range="192-200" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.avc.encoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="137-151" />
+            <Limit name="measured-frame-rate-720x480" range="53-53" />
+            <Limit name="measured-frame-rate-1280x720" range="25-26" />
+            <Limit name="measured-frame-rate-1920x1080" range="12-12" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.hevc.encoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="37-45" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.mpeg4.encoder" type="video/mp4v-es" update="true">
+            <Limit name="measured-frame-rate-176x144" range="232-235" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp8.encoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="69-69" />
+            <Limit name="measured-frame-rate-640x360" range="35-35" />
+            <Limit name="measured-frame-rate-1280x720" range="17-17" />
+            <Limit name="measured-frame-rate-1920x1080" range="8-8" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.avc.encoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="388-390" />
+            <Limit name="measured-frame-rate-720x480" range="125-127" />
+            <Limit name="measured-frame-rate-1280x720" range="60-62" />
+            <Limit name="measured-frame-rate-1920x1080" range="29-29" />
+        </MediaCodec>
+    </Encoders>
+    <Decoders>
+        <MediaCodec name="c2.android.h263.decoder" type="video/3gpp" update="true">
+            <Limit name="measured-frame-rate-176x144" range="397-407" />
+            <Limit name="measured-frame-rate-352x288" range="189-249" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.avc.decoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="226-247" />
+            <Limit name="measured-frame-rate-720x480" range="79-79" />
+            <Limit name="measured-frame-rate-1280x720" range="28-29" />
+            <Limit name="measured-frame-rate-1920x1080" range="12-12" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.hevc.decoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-352x288" range="167-237" />
+            <Limit name="measured-frame-rate-640x360" range="99-101" />
+                        <Limit name="measured-frame-rate-720x480" range="92-93" />
+            <Limit name="measured-frame-rate-1280x720" range="41-41" />
+            <Limit name="measured-frame-rate-1920x1080" range="23-23" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.mpeg4.decoder" type="video/mp4v-es" update="true">
+            <Limit name="measured-frame-rate-176x144" range="395-504" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp8.decoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="274-301" />
+            <Limit name="measured-frame-rate-640x360" range="81-83" />
+            <Limit name="measured-frame-rate-1280x720" range="19-20" />
+            <Limit name="measured-frame-rate-1920x1080" range="8-8" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp9.decoder" type="video/x-vnd.on2.vp9" update="true">
+            <Limit name="measured-frame-rate-320x180" range="191-191" />
+            <Limit name="measured-frame-rate-640x360" range="78-78" />
+            <Limit name="measured-frame-rate-1280x720" range="36-36" />
+            <Limit name="measured-frame-rate-1920x1080" range="21-21" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.hevc.decoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-352x288" range="345-362" />
+            <Limit name="measured-frame-rate-640x360" range="319-333" />
+            <Limit name="measured-frame-rate-720x480" range="305-314" />
+            <Limit name="measured-frame-rate-1280x720" range="233-234" />
+            <Limit name="measured-frame-rate-1920x1080" range="132-135" />
+            <Limit name="measured-frame-rate-3840x2160" range="42-42" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.avc.decoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="319-400" />
+            <Limit name="measured-frame-rate-720x480" range="327-330" />
+            <Limit name="measured-frame-rate-1280x720" range="221-222" />
+            <Limit name="measured-frame-rate-1920x1080" range="107-108" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.h263.decoder" type="video/3gpp" update="true">
+            <Limit name="measured-frame-rate-176x144" range="397-407" />
+            <Limit name="measured-frame-rate-352x288" range="315-348" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mpeg4.decoder" type="video/mp4v-es" update="true">
+            <Limit name="measured-frame-rate-176x144" range="399-412" />
+            <Limit name="measured-frame-rate-480x360" range="197-407" />
+            <Limit name="measured-frame-rate-1280x720" range="172-255" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.vp8.decoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="172-179" />
+            <Limit name="measured-frame-rate-640x360" range="123-156" />
+            <Limit name="measured-frame-rate-720x480" range="246-247" />
+            <Limit name="measured-frame-rate-1280x720" range="99-102" />
+            <Limit name="measured-frame-rate-1920x1080" range="63-64" />
+            <Limit name="measured-frame-rate-3840x2160" range="34-35" />
+        </MediaCodec>
+    </Decoders>
+</MediaCodecs>
diff --git a/mediacodec-profile/imx8q/media_codecs_performance_c2_8qm.xml b/mediacodec-profile/imx8q/media_codecs_performance_c2_8qm.xml
new file mode 100644
index 0000000..9750f1d
--- /dev/null
+++ b/mediacodec-profile/imx8q/media_codecs_performance_c2_8qm.xml
@@ -0,0 +1,113 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<!-- Copyright 2018 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+
+<!-- Generated file for b1c1 using measurements between PPR1.180531.001 and PD1A.180717.001 -->
+<MediaCodecs>
+    <Encoders>
+        <MediaCodec name="c2.android.h263.encoder" type="video/3gpp" update="true">
+            <Limit name="measured-frame-rate-176x144" range="645-663" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.avc.encoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="203-208" />
+            <Limit name="measured-frame-rate-720x480" range="77-78" />
+            <Limit name="measured-frame-rate-1280x720" range="33-33" />
+            <Limit name="measured-frame-rate-1920x1080" range="12-12" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.hevc.encoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="42-42" />
+			<Limit name="measured-frame-rate-720x480" range="13-14" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.mpeg4.encoder" type="video/mp4v-es" update="true">
+            <Limit name="measured-frame-rate-176x144" range="615-623" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp8.encoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="187-189" />
+            <Limit name="measured-frame-rate-640x360" range="56-57" />
+            <Limit name="measured-frame-rate-1280x720" range="29-30" />
+            <Limit name="measured-frame-rate-1920x1080" range="8-8" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.avc.encoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="344-524" />
+            <Limit name="measured-frame-rate-720x480" range="219-221" />
+            <Limit name="measured-frame-rate-1280x720" range="109-118" />
+            <Limit name="measured-frame-rate-1920x1080" range="39-56" />
+        </MediaCodec>
+    </Encoders>
+    <Decoders>
+        <MediaCodec name="c2.android.h263.decoder" type="video/3gpp" update="true">
+            <Limit name="measured-frame-rate-176x144" range="729-761" />
+            <Limit name="measured-frame-rate-352x288" range="477-492" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.avc.decoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="193-261" />
+            <Limit name="measured-frame-rate-720x480" range="89-89" />
+            <Limit name="measured-frame-rate-1280x720" range="35-36" />
+            <Limit name="measured-frame-rate-1920x1080" range="12-12" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.hevc.decoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-352x288" range="263-269" />
+            <Limit name="measured-frame-rate-640x360" range="142-146" />
+            <Limit name="measured-frame-rate-720x480" range="126-127" />
+            <Limit name="measured-frame-rate-1280x720" range="58-58" />
+            <Limit name="measured-frame-rate-1920x1080" range="23-23" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.mpeg4.decoder" type="video/mp4v-es" update="true">
+            <Limit name="measured-frame-rate-176x144" range="475-482" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp8.decoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="382-469" />
+            <Limit name="measured-frame-rate-640x360" range="182 -183" />
+            <Limit name="measured-frame-rate-1280x720" range="48-48" />
+            <Limit name="measured-frame-rate-1920x1080" range="23-23" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp9.decoder" type="video/x-vnd.on2.vp9" update="true">
+            <Limit name="measured-frame-rate-320x180" range="375-379" />
+            <Limit name="measured-frame-rate-640x360" range="120-122" />
+            <Limit name="measured-frame-rate-1280x720" range="59-59" />
+            <Limit name="measured-frame-rate-1920x1080" range="36-36" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.hevc.decoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-352x288" range="378-397" />
+            <Limit name="measured-frame-rate-640x360" range="358-362" />
+            <Limit name="measured-frame-rate-720x480" range="329-348" />
+            <Limit name="measured-frame-rate-1280x720" range="300-305" />
+            <Limit name="measured-frame-rate-1920x1080" range="216-226" />
+            <Limit name="measured-frame-rate-3840x2160" range="76-76" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.avc.decoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="429-446" />
+            <Limit name="measured-frame-rate-720x480" range="380-399" />
+            <Limit name="measured-frame-rate-1280x720" range="261-267" />
+            <Limit name="measured-frame-rate-1920x1080" range="149-150" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.h263.decoder" type="video/3gpp" update="true">
+            <Limit name="measured-frame-rate-176x144" range="482-486" />
+            <Limit name="measured-frame-rate-352x288" range="383-384" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mpeg4.decoder" type="video/mp4v-es" update="true">
+            <Limit name="measured-frame-rate-176x144" range="475-482" />
+            <Limit name="measured-frame-rate-480x360" range="360-369" />
+            <Limit name="measured-frame-rate-1280x720" range="244-244" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.vp8.decoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="273-273" />
+            <Limit name="measured-frame-rate-640x360" range="234-234" />
+            <Limit name="measured-frame-rate-1280x720" range="140-140" />
+            <Limit name="measured-frame-rate-1920x1080" range="82-82" />
+            <Limit name="measured-frame-rate-3840x2160" range="34-35" />
+        </MediaCodec>
+    </Decoders>
+</MediaCodecs>
diff --git a/mediacodec-profile/imx8q/media_codecs_performance_c2_8qxp.xml b/mediacodec-profile/imx8q/media_codecs_performance_c2_8qxp.xml
new file mode 100644
index 0000000..7d4d454
--- /dev/null
+++ b/mediacodec-profile/imx8q/media_codecs_performance_c2_8qxp.xml
@@ -0,0 +1,113 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<!-- Copyright 2018 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+
+<!-- Generated file for b1c1 using measurements between PPR1.180531.001 and PD1A.180717.001 -->
+<MediaCodecs>
+    <Encoders>
+        <MediaCodec name="c2.android.h263.encoder" type="video/3gpp" update="true">
+            <Limit name="measured-frame-rate-176x144" range="192-200" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.avc.encoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="137-151" />
+            <Limit name="measured-frame-rate-720x480" range="53-53" />
+            <Limit name="measured-frame-rate-1280x720" range="25-26" />
+            <Limit name="measured-frame-rate-1920x1080" range="12-12" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.hevc.encoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="37-45" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.mpeg4.encoder" type="video/mp4v-es" update="true">
+            <Limit name="measured-frame-rate-176x144" range="232-235" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp8.encoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="69-69" />
+            <Limit name="measured-frame-rate-640x360" range="35-35" />
+            <Limit name="measured-frame-rate-1280x720" range="17-17" />
+            <Limit name="measured-frame-rate-1920x1080" range="8-8" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.avc.encoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="388-390" />
+            <Limit name="measured-frame-rate-720x480" range="125-127" />
+            <Limit name="measured-frame-rate-1280x720" range="60-62" />
+            <Limit name="measured-frame-rate-1920x1080" range="29-29" />
+        </MediaCodec>
+    </Encoders>
+    <Decoders>
+        <MediaCodec name="c2.android.h263.decoder" type="video/3gpp" update="true">
+            <Limit name="measured-frame-rate-176x144" range="397-407" />
+            <Limit name="measured-frame-rate-352x288" range="189-249" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.avc.decoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="226-247" />
+            <Limit name="measured-frame-rate-720x480" range="79-79" />
+            <Limit name="measured-frame-rate-1280x720" range="28-29" />
+            <Limit name="measured-frame-rate-1920x1080" range="12-12" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.hevc.decoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-352x288" range="167-237" />
+            <Limit name="measured-frame-rate-640x360" range="99-101" />
+                        <Limit name="measured-frame-rate-720x480" range="92-93" />
+            <Limit name="measured-frame-rate-1280x720" range="41-41" />
+            <Limit name="measured-frame-rate-1920x1080" range="23-23" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.mpeg4.decoder" type="video/mp4v-es" update="true">
+            <Limit name="measured-frame-rate-176x144" range="395-504" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp8.decoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="274-301" />
+            <Limit name="measured-frame-rate-640x360" range="81-83" />
+            <Limit name="measured-frame-rate-1280x720" range="19-20" />
+            <Limit name="measured-frame-rate-1920x1080" range="8-8" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp9.decoder" type="video/x-vnd.on2.vp9" update="true">
+            <Limit name="measured-frame-rate-320x180" range="191-191" />
+            <Limit name="measured-frame-rate-640x360" range="78-78" />
+            <Limit name="measured-frame-rate-1280x720" range="36-36" />
+            <Limit name="measured-frame-rate-1920x1080" range="21-21" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.hevc.decoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-352x288" range="345-362" />
+            <Limit name="measured-frame-rate-640x360" range="319-333" />
+            <Limit name="measured-frame-rate-720x480" range="305-314" />
+            <Limit name="measured-frame-rate-1280x720" range="233-234" />
+            <Limit name="measured-frame-rate-1920x1080" range="132-135" />
+            <Limit name="measured-frame-rate-3840x2160" range="42-42" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.avc.decoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="319-400" />
+            <Limit name="measured-frame-rate-720x480" range="327-330" />
+            <Limit name="measured-frame-rate-1280x720" range="221-222" />
+            <Limit name="measured-frame-rate-1920x1080" range="107-108" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.h263.decoder" type="video/3gpp" update="true">
+            <Limit name="measured-frame-rate-176x144" range="397-407" />
+            <Limit name="measured-frame-rate-352x288" range="315-348" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mpeg4.decoder" type="video/mp4v-es" update="true">
+            <Limit name="measured-frame-rate-176x144" range="399-412" />
+            <Limit name="measured-frame-rate-480x360" range="197-407" />
+            <Limit name="measured-frame-rate-1280x720" range="172-255" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.vp8.decoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="172-179" />
+            <Limit name="measured-frame-rate-640x360" range="123-156" />
+            <Limit name="measured-frame-rate-720x480" range="246-247" />
+            <Limit name="measured-frame-rate-1280x720" range="99-102" />
+            <Limit name="measured-frame-rate-1920x1080" range="63-64" />
+            <Limit name="measured-frame-rate-3840x2160" range="34-35" />
+        </MediaCodec>
+    </Decoders>
+</MediaCodecs>
diff --git a/mediacodec-profile/imxaiy8mq/media_codecs_c2.xml b/mediacodec-profile/imxaiy8mq/media_codecs_c2.xml
new file mode 100644
index 0000000..cfe88eb
--- /dev/null
+++ b/mediacodec-profile/imxaiy8mq/media_codecs_c2.xml
@@ -0,0 +1,40 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<!--
+    Copyright (C) 2018 The Android Open Source Project
+
+    Licensed under the Apache License, Version 2.0 (the "License");
+    you may not use this file except in compliance with the License.
+    You may obtain a copy of the License at
+
+     http://www.apache.org/licenses/LICENSE-2.0
+
+    Unless required by applicable law or agreed to in writing, software
+    distributed under the License is distributed on an "AS IS" BASIS,
+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+    See the License for the specific language governing permissions and
+    limitations under the License.
+-->
+
+
+<Included>
+    <Decoders>
+       <MediaCodec name="c2.imx.avc.decoder" type="video/avc" >
+            <Limit name="size" min="64x64" max="4096x2160" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="1036800" />
+            <Limit name="bitrate" range="1-50000000" />
+            <Limit name="concurrent-instances" max="8" />
+            <Limit name="performance-point-4096x2304" value="28" />
+            <Limit name="performance-point-3840x2160" value="30" />
+            <Limit name="performance-point-1920x1080" value="120" />
+            <Limit name="performance-point-1280x720" value="240" />
+            <Feature name="adaptive-playback" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mp3.decoder.sw" type="audio/mpeg">
+            <Limit name="channel-count" max="2" />
+            <Limit name="sample-rate" ranges="8000,11025,12000,16000,22050,24000,32000,44100,48000" />
+            <Limit name="bitrate" range="4000-448000" />
+        </MediaCodec>
+    </Decoders>
+</Included>
diff --git a/mediacodec-profile/imxaiy8mq/media_codecs_performance_c2.xml b/mediacodec-profile/imxaiy8mq/media_codecs_performance_c2.xml
new file mode 100644
index 0000000..7e4b856
--- /dev/null
+++ b/mediacodec-profile/imxaiy8mq/media_codecs_performance_c2.xml
@@ -0,0 +1,114 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<!-- Copyright 2018 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+
+<!-- Generated file for b1c1 using measurements between PPR1.180531.001 and PD1A.180717.001 -->
+<MediaCodecs>
+    <Encoders>
+        <MediaCodec name="c2.android.h263.encoder" type="video/3gpp" update="true">
+            <Limit name="measured-frame-rate-176x144" range="152-159" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.avc.encoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="198-198" />
+            <Limit name="measured-frame-rate-720x480" range="57-57" />
+            <Limit name="measured-frame-rate-1280x720" range="18-18" />
+            <Limit name="measured-frame-rate-1920x1080" range="7-8" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.hevc.encoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="37-45" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.mpeg4.encoder" type="video/mp4v-es" update="true">
+            <Limit name="measured-frame-rate-176x144" range="171-171" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp8.encoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="49-53" />
+            <Limit name="measured-frame-rate-640x360" range="35-35" />
+            <Limit name="measured-frame-rate-1280x720" range="12-13" />
+            <Limit name="measured-frame-rate-1920x1080" range="5-5" />
+        </MediaCodec>
+    </Encoders>
+    <Decoders>
+        <MediaCodec name="c2.imx.h263.decoder" type="video/3gpp" update="true">
+            <Limit name="measured-frame-rate-192x144" range="1221-1293" />
+            <Limit name="measured-frame-rate-352x288" range="1261-1331" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.avc.decoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="831-1165" />
+            <Limit name="measured-frame-rate-720x480" range="556-575" />
+            <Limit name="measured-frame-rate-1280x720" range="299-306" />
+            <Limit name="measured-frame-rate-1920x1080" range="138-138" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.mpeg4.decoder" type="video/mp4v-es" update="true">
+            <Limit name="measured-frame-rate-176x144" range="1286-1294" />
+            <Limit name="measured-frame-rate-480x360" range="1138-1164" />
+            <Limit name="measured-frame-rate-1280x720" range="168-168" />
+            <Limit name="measured-frame-rate-1920x1080" range="70-70" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.vp8.decoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="1064-1084" />
+            <Limit name="measured-frame-rate-640x360" range="863-956" />
+            <Limit name="measured-frame-rate-1280x720" range="332-335" />
+            <Limit name="measured-frame-rate-1920x1080" range="150-150" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.vp9.decoder" type="video/x-vnd.on2.vp9" update="true">
+            <Limit name="measured-frame-rate-320x240" range="805-817" />
+            <Limit name="measured-frame-rate-640x360" range="757-767" />
+            <Limit name="measured-frame-rate-1280x720" range="546-551" />
+            <Limit name="measured-frame-rate-1920x1080" range="364-365" />
+            <Limit name="measured-frame-rate-3840x2160" range="87-87" />
+        </MediaCodec>
+        <MediaCodec name="c2.imx.hevc.decoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-352x288" range="733-816" />
+            <Limit name="measured-frame-rate-640x360" range="731-734" />
+            <Limit name="measured-frame-rate-720x480" range="694-714" />
+            <Limit name="measured-frame-rate-1280x720" range="550-561" />
+            <Limit name="measured-frame-rate-1920x1080" range="330-335" />
+            <Limit name="measured-frame-rate-3840x2160" range="98-98" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.h263.decoder" type="video/3gpp" update="true">
+            <Limit name="measured-frame-rate-176x144" range="440-461" />
+            <Limit name="measured-frame-rate-352x288" range="286-293" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.avc.decoder" type="video/avc" update="true">
+            <Limit name="measured-frame-rate-320x240" range="139-146" />
+            <Limit name="measured-frame-rate-720x480" range="120-120" />
+            <Limit name="measured-frame-rate-1280x720" range="48-48" />
+            <Limit name="measured-frame-rate-1920x1080" range="20-20" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.hevc.decoder" type="video/hevc" update="true">
+            <Limit name="measured-frame-rate-352x288" range="153-157" />
+            <Limit name="measured-frame-rate-640x360" range="140-145" />
+            <Limit name="measured-frame-rate-720x480" range="130-135" />
+            <Limit name="measured-frame-rate-1280x720" range="60-61" />
+            <Limit name="measured-frame-rate-1920x1080" range="39-40" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.mpeg4.decoder" type="video/mp4v-es" update="true">
+            <Limit name="measured-frame-rate-176x144" range="570-577" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp8.decoder" type="video/x-vnd.on2.vp8" update="true">
+            <Limit name="measured-frame-rate-320x180" range="296-297" />
+            <Limit name="measured-frame-rate-640x360" range="97-98" />
+            <Limit name="measured-frame-rate-1280x720" range="23-24" />
+            <Limit name="measured-frame-rate-1920x1080" range="9-9" />
+        </MediaCodec>
+        <MediaCodec name="c2.android.vp9.decoder" type="video/x-vnd.on2.vp9" update="true">
+            <Limit name="measured-frame-rate-320x180" range="188-192" />
+            <Limit name="measured-frame-rate-640x360" range="125-130" />
+            <Limit name="measured-frame-rate-1280x720" range="60-63" />
+            <Limit name="measured-frame-rate-1920x1080" range="37-37" />
+        </MediaCodec>
+    </Decoders>
+</MediaCodecs>
+
diff --git a/mediacodec-profile/media_codecs.xml b/mediacodec-profile/media_codecs.xml
new file mode 100644
index 0000000..ba2d75e
--- /dev/null
+++ b/mediacodec-profile/media_codecs.xml
@@ -0,0 +1,18 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<!-- Copyright (C) 2012 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+
+<MediaCodecs>
+</MediaCodecs>
diff --git a/mediacodec-profile/media_codecs_performance.xml b/mediacodec-profile/media_codecs_performance.xml
new file mode 100644
index 0000000..36f050a
--- /dev/null
+++ b/mediacodec-profile/media_codecs_performance.xml
@@ -0,0 +1,19 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<!-- Copyright 2015 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+
+<MediaCodecs>
+</MediaCodecs>
+
diff --git a/mediacodec-profile/mediacodec-profile.mk b/mediacodec-profile/mediacodec-profile.mk
new file mode 100644
index 0000000..250bc6a
--- /dev/null
+++ b/mediacodec-profile/mediacodec-profile.mk
@@ -0,0 +1,235 @@
+LOCAL_PATH := $(call my-dir)
+
+#for media codec c2
+include $(CLEAR_VARS)
+ifeq ($(BOARD_SOC_TYPE),IMX8MQ)
+ifeq ($(BOARD_TYPE),AIY)
+SUB_PATH := imxaiy8mq
+else
+SUB_PATH := imx8mq
+endif
+endif
+ifeq ($(BOARD_SOC_TYPE),IMX8Q)
+SUB_PATH := imx8q
+endif
+ifeq ($(BOARD_SOC_TYPE),IMX8MM)
+SUB_PATH := imx8mm
+endif
+ifeq ($(BOARD_SOC_TYPE),IMX8MN)
+SUB_PATH := imx8mn
+endif
+ifeq ($(BOARD_SOC_TYPE),IMX8MP)
+SUB_PATH := imx8mp
+endif
+
+FILE_NAME := media_codecs_c2
+LOCAL_SRC_FILES := $(SUB_PATH)/$(FILE_NAME)_temp.xml
+include $(LOCAL_PATH)/check_restricted_codec.mk
+LOCAL_MODULE := media_codecs_c2.xml
+LOCAL_MODULE_CLASS := ETC
+LOCAL_VENDOR_MODULE := true
+LOCAL_POST_INSTALL_CMD := rm -f $(LOCAL_PATH)/$(SUB_PATH)/$(FILE_NAME)_temp.xml
+include $(BUILD_PREBUILT)
+
+ifeq ($(BOARD_SOC_TYPE),IMX8Q)
+include $(CLEAR_VARS)
+SUB_PATH := imx8q
+FILE_NAME := media_codecs_8qxp
+LOCAL_SRC_FILES := $(SUB_PATH)/$(FILE_NAME)_temp.xml
+include $(LOCAL_PATH)/check_restricted_codec.mk
+LOCAL_MODULE := $(FILE_NAME).xml
+LOCAL_MODULE_CLASS := ETC
+LOCAL_VENDOR_MODULE := true
+LOCAL_MODULE_PATH := $(TARGET_OUT_VENDOR)/vendor_overlay_soc/imx8qxp/vendor/etc
+LOCAL_MODULE_STEM := media_codecs_c2.xml
+LOCAL_POST_INSTALL_CMD := rm -f $(LOCAL_PATH)/$(SUB_PATH)/$(FILE_NAME)_temp.xml
+include $(BUILD_PREBUILT)
+endif
+
+ifeq ($(BOARD_SOC_TYPE),IMX8Q)
+include $(CLEAR_VARS)
+SUB_PATH := imx8q
+FILE_NAME := media_codecs_8qm
+LOCAL_SRC_FILES := $(SUB_PATH)/$(FILE_NAME)_temp.xml
+include $(LOCAL_PATH)/check_restricted_codec.mk
+LOCAL_MODULE := $(FILE_NAME).xml
+LOCAL_MODULE_CLASS := ETC
+LOCAL_VENDOR_MODULE := true
+LOCAL_MODULE_PATH := $(TARGET_OUT_VENDOR)/vendor_overlay_soc/imx8qm/vendor/etc
+LOCAL_MODULE_STEM := media_codecs_c2.xml
+LOCAL_POST_INSTALL_CMD := rm -f $(LOCAL_PATH)/$(SUB_PATH)/$(FILE_NAME)_temp.xml
+include $(BUILD_PREBUILT)
+endif
+
+include $(CLEAR_VARS)
+LOCAL_SRC_FILES := media_codecs.xml
+LOCAL_MODULE := media_codecs.xml
+LOCAL_MODULE_CLASS := ETC
+LOCAL_VENDOR_MODULE := true
+include $(BUILD_PREBUILT)
+
+HAVE_AC3 = $(shell test -f $(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/fsl_ac3_dec/media_codecs_c2_ac3.xml && echo yes)
+ifeq ($(HAVE_AC3), yes)
+include $(CLEAR_VARS)
+LOCAL_SRC_FILES = ../../../../$(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/fsl_ac3_dec/media_codecs_c2_ac3.xml
+LOCAL_MODULE := media_codecs_c2_ac3.xml
+LOCAL_MODULE_CLASS := ETC
+LOCAL_VENDOR_MODULE := true
+include $(BUILD_PREBUILT)
+endif
+
+HAVE_DDP = $(shell test -f $(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/fsl_ddp_dec/media_codecs_c2_ddp.xml && echo yes)
+ifeq ($(HAVE_DDP), yes)
+include $(CLEAR_VARS)
+LOCAL_SRC_FILES = ../../../../$(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/fsl_ddp_dec/media_codecs_c2_ddp.xml
+LOCAL_MODULE := media_codecs_c2_ddp.xml
+LOCAL_MODULE_CLASS := ETC
+LOCAL_VENDOR_MODULE := true
+include $(BUILD_PREBUILT)
+endif
+
+HAVE_MS = $(shell test -f $(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/fsl_ms_codec/media_codecs_c2_ms.xml && echo yes)
+ifeq ($(HAVE_MS), yes)
+include $(CLEAR_VARS)
+LOCAL_SRC_FILES = ../../../../$(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/fsl_ms_codec/media_codecs_c2_ms.xml
+LOCAL_MODULE := media_codecs_c2_ms.xml
+LOCAL_MODULE_CLASS := ETC
+LOCAL_VENDOR_MODULE := true
+include $(BUILD_PREBUILT)
+endif
+
+HAVE_WMV9 = $(shell test -f $(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/fsl_ms_codec/media_codecs_c2_wmv9.xml && echo yes)
+ifeq ($(HAVE_WMV9), yes)
+ifneq ($(findstring $(BOARD_SOC_TYPE),  IMX8Q IMX8MQ),)
+include $(CLEAR_VARS)
+LOCAL_SRC_FILES = ../../../../$(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/fsl_ms_codec/media_codecs_c2_wmv9.xml
+
+ifneq ($(findstring $(BOARD_SOC_TYPE),  IMX8MQ),)
+LOCAL_SRC_FILES := ../../../../$(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/fsl_ms_codec/media_codecs_c2_wmv9_hantro.xml
+endif
+
+LOCAL_MODULE := media_codecs_c2_wmv9.xml
+LOCAL_MODULE_CLASS := ETC
+LOCAL_VENDOR_MODULE := true
+include $(BUILD_PREBUILT)
+endif
+endif
+
+HAVE_RA = $(shell test -f $(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/fsl_real_dec/media_codecs_c2_ra.xml && echo yes)
+ifeq ($(HAVE_RA), yes)
+include $(CLEAR_VARS)
+LOCAL_SRC_FILES = ../../../../$(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/fsl_real_dec/media_codecs_c2_ra.xml
+LOCAL_MODULE := media_codecs_c2_ra.xml
+LOCAL_MODULE_CLASS := ETC
+LOCAL_VENDOR_MODULE := true
+include $(BUILD_PREBUILT)
+endif
+
+HAVE_RV = $(shell test -f $(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/fsl_real_dec/media_codecs_c2_rv.xml && echo yes)
+ifeq ($(HAVE_RV), yes)
+ifneq ($(findstring $(BOARD_SOC_TYPE),  IMX8MQ IMX8Q),)
+include $(CLEAR_VARS)
+LOCAL_SRC_FILES = ../../../../$(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/fsl_real_dec/media_codecs_c2_rv.xml
+LOCAL_MODULE := media_codecs_c2_rv.xml
+LOCAL_MODULE_CLASS := ETC
+LOCAL_VENDOR_MODULE := true
+include $(BUILD_PREBUILT)
+endif
+endif
+
+ifneq ($(findstring $(BOARD_SOC_TYPE),  IMX8MP IMX8Q),)
+
+HAVE_DSP_AACP = $(shell test -f $(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/imx_dsp_aacp_dec/media_codecs_c2_dsp_aacp.xml && echo yes)
+ifeq ($(HAVE_DSP_AACP), yes)
+include $(CLEAR_VARS)
+LOCAL_SRC_FILES = ../../../../$(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/imx_dsp_aacp_dec/media_codecs_c2_dsp_aacp.xml
+LOCAL_MODULE := media_codecs_c2_dsp_aacp.xml
+LOCAL_MODULE_CLASS := ETC
+LOCAL_VENDOR_MODULE := true
+include $(BUILD_PREBUILT)
+endif
+
+HAVE_DSP_WMA = $(shell test -f $(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/imx_dsp_wma_dec/media_codecs_c2_dsp_wma.xml && echo yes)
+ifeq ($(HAVE_DSP_WMA), yes)
+include $(CLEAR_VARS)
+LOCAL_SRC_FILES = ../../../../$(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/imx_dsp_wma_dec/media_codecs_c2_dsp_wma.xml
+LOCAL_MODULE := media_codecs_c2_dsp_wma.xml
+LOCAL_MODULE_CLASS := ETC
+LOCAL_VENDOR_MODULE := true
+include $(BUILD_PREBUILT)
+endif
+
+HAVE_DSP = $(shell test -f $(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/imx_dsp_codec/media_codecs_c2_dsp.xml && echo yes)
+ifeq ($(HAVE_DSP), yes)
+include $(CLEAR_VARS)
+LOCAL_SRC_FILES = ../../../../$(FSL_RESTRICTED_CODEC_PATH)/fsl-restricted-codec/imx_dsp_codec/media_codecs_c2_dsp.xml
+LOCAL_MODULE := media_codecs_c2_dsp.xml
+LOCAL_MODULE_CLASS := ETC
+LOCAL_VENDOR_MODULE := true
+include $(BUILD_PREBUILT)
+endif
+
+endif
+
+#for media codec performance setting
+include $(CLEAR_VARS)
+LOCAL_MODULE := media_codecs_performance.xml
+LOCAL_SRC_FILES := media_codecs_performance.xml
+LOCAL_MODULE_CLASS := ETC
+LOCAL_VENDOR_MODULE := true
+include $(BUILD_PREBUILT)
+
+#for media codec performance setting
+include $(CLEAR_VARS)
+ifeq ($(BOARD_SOC_TYPE),IMX7ULP)
+LOCAL_SRC_FILES := imx7ulp/media_codecs_performance_c2.xml
+endif
+ifeq ($(BOARD_SOC_TYPE),IMX8MQ)
+ifeq ($(BOARD_TYPE),AIY)
+LOCAL_SRC_FILES := imxaiy8mq/media_codecs_performance_c2.xml
+else
+LOCAL_SRC_FILES := imx8mq/media_codecs_performance_c2.xml
+endif
+endif
+ifeq ($(BOARD_SOC_TYPE),IMX8Q)
+LOCAL_SRC_FILES := imx8q/media_codecs_performance_c2.xml
+endif
+ifeq ($(BOARD_SOC_TYPE),IMX8MM)
+LOCAL_SRC_FILES := imx8mm/media_codecs_performance_c2.xml
+endif
+ifeq ($(BOARD_SOC_TYPE),IMX8MN)
+LOCAL_SRC_FILES := imx8mn/media_codecs_performance_c2.xml
+endif
+ifeq ($(BOARD_SOC_TYPE),IMX8MP)
+LOCAL_SRC_FILES := imx8mp/media_codecs_performance_c2.xml
+endif
+LOCAL_MODULE := media_codecs_performance_c2.xml
+LOCAL_MODULE_CLASS := ETC
+LOCAL_VENDOR_MODULE := true
+include $(BUILD_PREBUILT)
+
+ifeq ($(BOARD_SOC_TYPE),IMX8Q)
+include $(CLEAR_VARS)
+SUB_PATH := imx8q
+FILE_NAME := media_codecs_performance_c2_8qm
+LOCAL_MODULE := $(FILE_NAME).xml
+LOCAL_MODULE_CLASS := ETC
+LOCAL_VENDOR_MODULE := true
+LOCAL_SRC_FILES := imx8q/$(FILE_NAME).xml
+LOCAL_MODULE_PATH := $(TARGET_OUT_VENDOR)/vendor_overlay_soc/imx8qm/vendor/etc
+LOCAL_MODULE_STEM := media_codecs_performance_c2.xml
+include $(BUILD_PREBUILT)
+endif
+
+ifeq ($(BOARD_SOC_TYPE),IMX8Q)
+include $(CLEAR_VARS)
+SUB_PATH := imx8q
+FILE_NAME := media_codecs_performance_c2_8qxp
+LOCAL_MODULE := $(FILE_NAME).xml
+LOCAL_MODULE_CLASS := ETC
+LOCAL_VENDOR_MODULE := true
+LOCAL_SRC_FILES := imx8q/$(FILE_NAME).xml
+LOCAL_MODULE_PATH := $(TARGET_OUT_VENDOR)/vendor_overlay_soc/imx8qxp/vendor/etc
+LOCAL_MODULE_STEM := media_codecs_performance_c2.xml
+include $(BUILD_PREBUILT)
+endif
